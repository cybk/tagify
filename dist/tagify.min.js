"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}/**
 * Tagify (v 4.5.0) - tags input component
 * By Yair Even-Or
 * Don't sell this code. (c)
 * https://github.com/yairEO/tagify
 */!function(a,b){"object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):(a="undefined"==typeof globalThis?a||self:globalThis).Tagify=b()}(void 0,function(){"use strict";function b(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function c(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function j(a,b){var c,d={};for(c in a)0>b.indexOf(c)&&(d[c]=a[c]);return d}function k(a){var b=document.createElement("div");return a.replace(/\&#?[0-9a-z]+;/gi,function(a){return b.innerHTML=a,b.innerText})}function a(a,b){for(b=b||"previous";a=a[b+"Sibling"];)if(3==a.nodeType)return a}function m(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/`|'/g,"&#039;")}function q(a){var b=Object.prototype.toString.call(a).split(" ")[1].slice(0,-1);return a===Object(a)&&"Array"!=b&&"Function"!=b&&"RegExp"!=b&&"HTMLUnknownElement"!=b}function v(a,b,c){function d(a,b){for(var c in b)if(b.hasOwnProperty(c)){if(q(b[c])){q(a[c])?d(a[c],b[c]):a[c]=Object.assign({},b[c]);continue}if(Array.isArray(b[c])){a[c]=Object.assign([],b[c]);continue}a[c]=b[c]}}return a instanceof Object||(a={}),d(a,b),c&&d(a,c),a}function r(a){return String.prototype.normalize?"string"==typeof a?a.normalize("NFD").replace(/[\u0300-\u036f]/g,""):void 0:a}function d(){for(var a in this.dropdown={},this._dropdown)this.dropdown[a]="function"==typeof this._dropdown[a]?this._dropdown[a].bind(this):this._dropdown[a];0<=this.settings.dropdown.enabled&&this.dropdown.init()}function e(a,b){return a?a.previousElementSibling&&a.previousElementSibling.classList.contains("tagify")?(console.warn("Tagify: ","input element is already Tagified",a),this):(v(this,function(b){function a(a,b,d){d&&b.split(/\s+/g).forEach(function(b){return c[a+"EventListener"].call(c,b,d)})}var c=document.createTextNode("");return{off:function d(b,c){return a("remove",b,c),this},on:function d(b,c){return c&&"function"==typeof c&&a("add",b,c),this},trigger:function k(d,e,f){var g;if(f=f||{cloneData:!0},d)if(b.settings.isJQueryPlugin)"remove"==d&&(d="removeTag"),jQuery(b.DOM.originalInput).triggerHandler(d,[e]);else{try{var h="object"==("undefined"==typeof e?"undefined":_typeof(e))?e:{value:e};if((h=f.cloneData?v({},h):h).tagify=this,e instanceof Object)for(var j in e)e[j]instanceof HTMLElement&&(h[j]=e[j]);g=new CustomEvent(d,{detail:h})}catch(a){console.warn(a)}c.dispatchEvent(g)}}}}(this)),this.isFirefox="undefined"!=typeof InstallTrigger,this.isIE=window.document.documentMode,this.applySettings(a,b||{}),this.state={inputText:"",editing:!1,actions:{},mixMode:{},dropdown:{},flaggedTags:{}},this.value=[],this.listeners={},this.DOM={},this.build(a),d.call(this),this.getCSSVars(),this.loadOriginalValues(),this.events.customBinding.call(this),this.events.binding.call(this),void(a.autofocus&&this.DOM.input.focus())):(console.warn("Tagify: ","input element not found",a),this)}var f,g=function(a,b,c,d){return a=""+a,b=""+b,d&&(a=a.trim(),b=b.trim()),c?a==b:a.toLowerCase()==b.toLowerCase()},w=function(){return /(?=.*chrome)(?=.*android)/i.test(navigator.userAgent)},h={delimiters:",",pattern:null,tagTextProp:"value",maxTags:1/0,callbacks:{},addTagOnBlur:!0,duplicates:!1,whitelist:[],blacklist:[],enforceWhitelist:!1,keepInvalidTags:!1,mixTagsAllowedAfter:/,|\.|\:|\s/,mixTagsInterpolator:["[[","]]"],backspace:!0,skipInvalid:!1,pasteAsTags:!0,editTags:{clicks:2,keepInvalid:!0},transformTag:function a(){},trim:!0,a11y:{focusableTags:!1},mixMode:{insertAfterTag:"\xA0"},autoComplete:{enabled:!0,rightKey:!1},classNames:{namespace:"tagify",mixMode:"tagify--mix",selectMode:"tagify--select",input:"tagify__input",focus:"tagify--focus",tag:"tagify__tag",tagNoAnimation:"tagify--noAnim",tagInvalid:"tagify--invalid",tagNotAllowed:"tagify--notAllowed",inputInvalid:"tagify__input--invalid",tagX:"tagify__tag__removeBtn",tagText:"tagify__tag-text",dropdown:"tagify__dropdown",dropdownWrapper:"tagify__dropdown__wrapper",dropdownItem:"tagify__dropdown__item",dropdownItemActive:"tagify__dropdown__item--active",dropdownInital:"tagify__dropdown--initial",scopeLoading:"tagify--loading",tagLoading:"tagify__tag--loading",tagEditing:"tagify__tag--editable",tagFlash:"tagify__tag--flash",tagHide:"tagify__tag--hide",hasMaxTags:"tagify--hasMaxTags",hasNoTags:"tagify--noTags",empty:"tagify--empty"},dropdown:{classname:"",enabled:2,maxItems:10,searchKeys:["value","searchBy"],fuzzySearch:!0,caseSensitive:!1,accentedSearch:!0,highlightFirst:!1,closeOnSelect:!0,clearOnSelect:!0,position:"all",appendTarget:null},hooks:{beforeRemoveTag:function a(){return Promise.resolve()},beforePaste:function a(){return Promise.resolve()},suggestionClick:function a(){return Promise.resolve()}}};return e.prototype={_dropdown:{init:function a(){this.DOM.dropdown=this.parseTemplate("dropdown",[this.settings]),this.DOM.dropdown.content=this.DOM.dropdown.querySelector(this.settings.classNames.dropdownWrapperSelector)},show:function d(b){var c,f,h,i=this,j=this.settings,k="mix"==j.mode&&!j.enforceWhitelist,m=!j.whitelist||!j.whitelist.length,l="manual"==j.dropdown.position;if(b=void 0===b?this.state.inputText:b,(!m||k||j.templates.dropdownItemNoMatch)&&!1!==j.dropdown.enable&&!this.state.isLoading){if(clearTimeout(this.dropdownHide__bindEventsTimeout),this.suggestedListItems=this.dropdown.filterListItems(b),b&&!this.suggestedListItems.length&&(this.trigger("dropdown:noMatch",b),j.templates.dropdownItemNoMatch&&(h=j.templates.dropdownItemNoMatch.call(this,{value:b}))),!h){if(this.suggestedListItems.length)b&&k&&!this.state.editing.scope&&!g(this.suggestedListItems[0].value,b)&&this.suggestedListItems.unshift({value:b});else{if(!b||!k||this.state.editing.scope)return this.input.autocomplete.suggest.call(this),void this.dropdown.hide();this.suggestedListItems=[{value:b}]}f=""+(q(c=this.suggestedListItems[0])?c.value:c),j.autoComplete&&f&&0==f.indexOf(b)&&this.input.autocomplete.suggest.call(this,c)}this.dropdown.fill(h),j.dropdown.highlightFirst&&this.dropdown.highlightOption(this.DOM.dropdown.content.children[0]),this.state.dropdown.visible||setTimeout(this.dropdown.events.binding.bind(this)),this.state.dropdown.visible=b||!0,this.state.dropdown.query=b,this.setStateSelection(),l||setTimeout(function(){i.dropdown.position(),i.dropdown.render()}),setTimeout(function(){i.trigger("dropdown:show",i.DOM.dropdown)})}},hide:function a(b){var c=this,d=this.DOM,e=d.scope,f=d.dropdown,g="manual"==this.settings.dropdown.position&&!b;if(f&&document.body.contains(f)&&!g)return window.removeEventListener("resize",this.dropdown.position),this.dropdown.events.binding.call(this,!1),e.setAttribute("aria-expanded",!1),f.parentNode.removeChild(f),setTimeout(function(){c.state.dropdown.visible=!1},100),this.state.dropdown.query=this.state.ddItemData=this.state.ddItemElm=this.state.selection=null,this.state.tag&&this.state.tag.value.length&&(this.state.flaggedTags[this.state.tag.baseOffset]=this.state.tag),this.trigger("dropdown:hide",f),this},render:function a(){var b,c,d,f=this,g=(b=this.DOM.dropdown,(d=b.cloneNode(!0)).style.cssText="position:fixed; top:-9999px; opacity:0",document.body.appendChild(d),c=d.clientHeight,d.parentNode.removeChild(d),c),h=this.settings;return this.DOM.scope.setAttribute("aria-expanded",!0),document.body.contains(this.DOM.dropdown)||(this.DOM.dropdown.classList.add(h.classNames.dropdownInital),this.dropdown.position(g),h.dropdown.appendTarget.appendChild(this.DOM.dropdown),setTimeout(function(){return f.DOM.dropdown.classList.remove(h.classNames.dropdownInital)})),this},fill:function c(a){var b;a="string"==typeof a?a:this.dropdown.createListHTML(a||this.suggestedListItems),this.DOM.dropdown.content.innerHTML=(b=a)?b.replace(/\>[\r\n ]+\</g,"><").replace(/(<.*?>)|\s+/g,function(a,b){return b||" "}):""},refilter:function b(a){a=a||this.state.dropdown.query||"",this.suggestedListItems=this.dropdown.filterListItems(a),this.dropdown.fill(),this.suggestedListItems.length||this.dropdown.hide(),this.trigger("dropdown:updated",this.DOM.dropdown)},position:function p(b){var c=this.settings.dropdown;if("manual"!=c.position){var e,f,j,k,m,q,u=this.DOM.dropdown,l=c.placeAbove,v=document.documentElement.clientHeight,h=480<Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)?c.position:"all",g=this.DOM["input"==h?"input":"scope"];b=b||u.clientHeight,this.state.dropdown.visible&&("text"==h?(j=(e=this.getCaretGlobalPosition()).bottom,f=e.top,k=e.left,m="auto"):(q=function(a){for(var b=0,c=0;a;)b+=a.offsetLeft||0,c+=a.offsetTop||0,a=a.parentNode;return{left:b,top:c}}(this.settings.dropdown.appendTarget),f=(e=g.getBoundingClientRect()).top-q.top,j=e.bottom-1-q.top,k=e.left-q.left,m=e.width+"px"),f=Math.floor(f),j=Math.ceil(j),l=void 0===l?v-e.bottom<b:l,u.style.cssText="left:"+(k+window.pageXOffset)+"px; width:"+m+";"+(l?"top: "+(f+window.pageYOffset)+"px":"top: "+(j+window.pageYOffset)+"px"),u.setAttribute("placement",l?"top":"bottom"),u.setAttribute("position",h))}},events:{binding:function e(){var a=!(0<arguments.length&&arguments[0]!==void 0)||arguments[0],b=this.dropdown.events.callbacks,c=this.listeners.dropdown=this.listeners.dropdown||{position:this.dropdown.position.bind(this),onKeyDown:b.onKeyDown.bind(this),onMouseOver:b.onMouseOver.bind(this),onMouseLeave:b.onMouseLeave.bind(this),onClick:b.onClick.bind(this),onScroll:b.onScroll.bind(this)},d=a?"addEventListener":"removeEventListener";"manual"!=this.settings.dropdown.position&&(window[d]("resize",c.position),window[d]("keydown",c.onKeyDown)),this.DOM.dropdown[d]("mouseover",c.onMouseOver),this.DOM.dropdown[d]("mouseleave",c.onMouseLeave),this.DOM.dropdown[d]("mousedown",c.onClick),this.DOM.dropdown.content[d]("scroll",c.onScroll)},callbacks:{onKeyDown:function a(b){var c=this,d=this.DOM.dropdown.querySelector(this.settings.classNames.dropdownItemActiveSelector),f=this.dropdown.getSuggestionDataByNode(d);switch(b.key){case"ArrowDown":case"ArrowUp":case"Down":case"Up":var g;b.preventDefault(),d&&(d=d[("ArrowUp"==b.key||"Up"==b.key?"previous":"next")+"ElementSibling"]),d||(g=this.DOM.dropdown.content.children,d=g["ArrowUp"==b.key||"Up"==b.key?g.length-1:0]),f=this.dropdown.getSuggestionDataByNode(d),this.dropdown.highlightOption(d,!0);break;case"Escape":case"Esc":this.dropdown.hide();break;case"ArrowRight":if(this.state.actions.ArrowLeft)return;case"Tab":if("mix"!=this.settings.mode&&d&&!this.settings.autoComplete.rightKey&&!this.state.editing){b.preventDefault();var h=this.dropdown.getMappedValue(f);return this.input.autocomplete.set.call(this,h),!1}return!0;case"Enter":b.preventDefault(),this.settings.hooks.suggestionClick(b,{tagify:this,tagData:f,suggestionElm:d}).then(function(){d?c.dropdown.selectOption(d):c.dropdown.hide(),"mix"!=c.settings.mode&&c.addTags(c.state.inputText.trim(),!0)}).catch(function(a){return a});break;case"Backspace":{if("mix"==this.settings.mode||this.state.editing.scope)return;var j=this.state.inputText.trim();""!=j&&8203!=j.charCodeAt(0)||(!0===this.settings.backspace?this.removeTags():"edit"==this.settings.backspace&&setTimeout(this.editTag.bind(this),0))}}},onMouseOver:function c(a){var b=a.target.closest(this.settings.classNames.dropdownItemSelector);b&&this.dropdown.highlightOption(b)},onMouseLeave:function a(){this.dropdown.highlightOption()},onClick:function e(a){var b=this;if(0==a.button&&a.target!=this.DOM.dropdown&&a.target!=this.DOM.dropdown.content){var c=a.target.closest(this.settings.classNames.dropdownItemSelector),d=this.dropdown.getSuggestionDataByNode(c);this.state.actions.selectOption=!0,setTimeout(function(){return b.state.actions.selectOption=!1},50),this.settings.hooks.suggestionClick(a,{tagify:this,tagData:d,suggestionElm:c}).then(function(){c?b.dropdown.selectOption(c):b.dropdown.hide()}).catch(function(a){return a})}},onScroll:function d(a){var b=a.target,c=100*(b.scrollTop/(b.scrollHeight-b.parentNode.clientHeight));this.trigger("dropdown:scroll",{percentage:Math.round(c)})}}},getSuggestionDataByNode:function c(a){var b=a?+a.getAttribute("tagifySuggestionIdx"):-1;return this.suggestedListItems[b]||null},highlightOption:function e(a,b){var c,d=this.settings.classNames.dropdownItemActive;return(this.state.ddItemElm&&(this.state.ddItemElm.classList.remove(d),this.state.ddItemElm.removeAttribute("aria-selected")),!a)?(this.state.ddItemData=null,this.state.ddItemElm=null,void this.input.autocomplete.suggest.call(this)):void(c=this.suggestedListItems[this.getNodeIndex(a)],this.state.ddItemData=c,this.state.ddItemElm=a,a.classList.add(d),a.setAttribute("aria-selected",!0),b&&(a.parentNode.scrollTop=a.clientHeight+a.offsetTop-a.parentNode.clientHeight),this.settings.autoComplete&&(this.input.autocomplete.suggest.call(this,c),this.dropdown.position()))},selectOption:function h(b){var c=this,d=this.settings.dropdown,e=d.clearOnSelect,f=d.closeOnSelect;if(!b)return this.addTags(this.state.inputText,!0),void(f&&this.dropdown.hide());var g=b.getAttribute("tagifySuggestionIdx"),a=this.suggestedListItems[+g];this.trigger("dropdown:select",{data:a,elm:b}),g&&a?(this.state.editing?this.onEditTagDone(null,v({__isValid:!0},a)):this["mix"==this.settings.mode?"addMixTags":"addTags"]([a],e),this.DOM.input.parentNode&&(setTimeout(function(){c.DOM.input.focus(),c.toggleFocusClass(!0)}),f?setTimeout(this.dropdown.hide.bind(this)):this.dropdown.refilter())):this.dropdown.hide()},selectAll:function a(){return this.suggestedListItems.length=0,this.dropdown.hide(),this.addTags(this.dropdown.filterListItems(""),!0),this},filterListItems:function B(b,d){function f(a,b){return b.toLowerCase().split(" ").every(function(b){return a.includes(b.toLowerCase())})}var j,k,v,w,x,y=this,z=this.settings,l=z.dropdown,h=(d=d||{},b="select"==z.mode&&this.value.length&&this.value[0][z.tagTextProp]==b?"":b,[]),g=z.whitelist,p=l.maxItems||1/0,A=l.searchKeys,u=0;if(!b||!A.length)return(z.duplicates?g:g.filter(function(a){return!y.isTagDuplicate(q(a)?a.value:a)})).slice(0,p);for(x=l.caseSensitive?""+b:(""+b).toLowerCase();u<g.length;u++){j=g[u]instanceof Object?g[u]:{value:g[u]};var C=Object.keys(j).some(function(a){return A.includes(a)})?A:["value"];if(l.fuzzySearch&&!d.exact?(v=C.reduce(function(a,b){return a+" "+(j[b]||"")},"").toLowerCase(),l.accentedSearch&&(v=r(v),x=r(x)),k=f(v,x)):k=C.some(function(a){var b=""+(j[a]||"");return l.accentedSearch&&(b=r(b),x=r(x)),l.caseSensitive||(b=b.toLowerCase()),d.exact?b==x:0==b.indexOf(x)}),w=!z.duplicates&&this.isTagDuplicate(q(j)?j.value:j),k&&!w&&p--&&h.push(j),0==p)break}return h},getMappedValue:function c(a){var b=this.settings.dropdown.mapValueTo;return b?"function"==typeof b?b(a):a[b]||a.value:a.value},createListHTML:function c(a){var b=this;return v([],a).map(function(a,c){"string"!=typeof a&&"number"!=typeof a||(a={value:a});var d=b.dropdown.getMappedValue(a);a.value=d&&"string"==typeof d?m(d):d;var e=b.settings.templates.dropdownItem.apply(b,[a,b]);return e=e.replace(/\s*tagifySuggestionIdx=(["'])(.*?)\1/gim,"").replace(">"," tagifySuggestionIdx=\""+c+"\">")}).join("")}},TEXTS:{empty:"empty",exceed:"number of tags exceeded",pattern:"pattern mismatch",duplicate:"already exists",notAllowed:"not allowed"},customEventsList:["change","add","remove","invalid","input","click","keydown","focus","blur","edit:input","edit:beforeUpdate","edit:updated","edit:start","edit:keydown","dropdown:show","dropdown:hide","dropdown:select","dropdown:updated","dropdown:noMatch","dropdown:scroll"],dataProps:["__isValid","__removed","__originalData","__originalHTML","__tagId"],trim:function b(a){return this.settings.trim&&a&&"string"==typeof a?a.trim():a},parseHTML:function b(a){return new DOMParser().parseFromString(a.trim(),"text/html").body.firstElementChild},templates:{wrapper:function c(a,b){return"<tags class=\""+b.classNames.namespace+" "+(b.mode?""+b.classNames[b.mode+"Mode"]:"")+" "+a.className+"\"\n                    "+(b.readonly?"readonly":"")+"\n                    "+(b.disabled?"disabled":"")+"\n                    "+(b.required?"required":"")+"\n                    tabIndex=\"-1\">\n            <span "+(b.readonly&&"mix"==b.mode?"":"contenteditable")+" data-placeholder=\""+(b.placeholder||"&#8203;")+"\" aria-placeholder=\""+(b.placeholder||"")+"\"\n                class=\""+b.classNames.input+"\"\n                role=\"textbox\"\n                aria-autocomplete=\"both\"\n                aria-multiline=\""+("mix"==b.mode)+"\"></span>\n        </tags>"},tag:function b(a){return"<tag title=\""+(a.title||a.value)+"\"\n                    contenteditable='false'\n                    spellcheck='false'\n                    tabIndex=\""+(this.settings.a11y.focusableTags?0:-1)+"\"\n                    class=\""+this.settings.classNames.tag+" "+(a.class?a.class:"")+"\"\n                    "+this.getAttributes(a)+">\n            <x title='' class=\""+this.settings.classNames.tagX+"\" role='button' aria-label='remove tag'></x>\n            <div>\n                <span class=\""+this.settings.classNames.tagText+"\">"+(a[this.settings.tagTextProp]||a.value)+"</span>\n            </div>\n        </tag>"},dropdown:function e(a){var b=a.dropdown,c="manual"==b.position,d=""+a.classNames.dropdown;return"<div class=\""+(c?"":d)+" "+b.classname+"\" role=\"listbox\" aria-labelledby=\"dropdown\">\n                    <div class=\""+a.classNames.dropdownWrapper+"\"></div>\n                </div>"},dropdownItem:function b(a){return"<div "+this.getAttributes(a)+"\n                    class='"+this.settings.classNames.dropdownItem+" "+(a.class?a.class:"")+"'\n                    tabindex=\"0\"\n                    role=\"option\">"+a.value+"</div>"},dropdownItemNoMatch:null},parseTemplate:function c(a,b){return a=this.settings.templates[a]||a,this.parseHTML(a.apply(this,b))},set whitelist(a){this.settings.whitelist=a&&Array.isArray(a)?a:[]},get whitelist(){return this.settings.whitelist},applySettings:function e(a,b){h.templates=this.templates;var c=this.settings=v({},h,b);c.disabled=a.hasAttribute("disabled"),c.readonly=a.hasAttribute("readonly"),c.placeholder=a.getAttribute("placeholder")||c.placeholder||"",c.required=a.hasAttribute("required");var d=function(a){Object.defineProperty(c.classNames,a+"Selector",{get:function b(){return"."+this[a].split(" ").join(".")}})};for(var a in c.classNames)d(a);if(this.isIE&&(c.autoComplete=!1),["whitelist","blacklist"].forEach(function(b){var d=a.getAttribute("data-"+b);d&&(d=d.split(c.delimiters))instanceof Array&&(c[b]=d)}),"autoComplete"in b&&!q(b.autoComplete)&&(c.autoComplete=h.autoComplete,c.autoComplete.enabled=b.autoComplete),"mix"==c.mode&&(c.autoComplete.rightKey=!0,c.delimiters=b.delimiters||null,c.tagTextProp&&!c.dropdown.searchKeys.includes(c.tagTextProp)&&c.dropdown.searchKeys.push(c.tagTextProp)),a.pattern)try{c.pattern=new RegExp(a.pattern)}catch(a){}if(this.settings.delimiters)try{c.delimiters=new RegExp(this.settings.delimiters,"g")}catch(a){}"select"==c.mode&&(c.dropdown.enabled=0),c.dropdown.appendTarget=b.dropdown&&b.dropdown.appendTarget?b.dropdown.appendTarget:document.body},getAttributes:function f(a){var b,c=this.getCustomAttributes(a),d="";for(b in c)d+=" "+b+(void 0===a[b]?"":"=\""+a[b]+"\"");return d},getCustomAttributes:function d(a){if(!q(a))return"";var b,c={};for(b in a)"__"!=b.slice(0,2)&&"class"!=b&&a.hasOwnProperty(b)&&void 0!==a[b]&&(c[b]=a[b]);return c},setStateSelection:function c(){var a=window.getSelection(),b={anchorOffset:a.anchorOffset,anchorNode:a.anchorNode,range:a.getRangeAt&&a.rangeCount&&a.getRangeAt(0)};return this.state.selection=b,b},getCaretGlobalPosition:function g(){var a=document.getSelection();if(a.rangeCount){var b=a.getRangeAt(0),c=b.startContainer,d=b.startOffset,e=void 0,f=void 0;if(0<d)return f=document.createRange(),f.setStart(c,d-1),f.setEnd(c,d),e=f.getBoundingClientRect(),{left:e.right,top:e.top,bottom:e.bottom};if(c.getBoundingClientRect)return c.getBoundingClientRect()}return{left:-9999,top:-9999}},getCSSVars:function c(){var a,b=getComputedStyle(this.DOM.scope,null);this.CSSVars={tagHideTransition:function(a){var b=a.value,c=a.unit;return"s"==c?1e3*b:b}(function(a){if(!a)return{};var b=(a=a.trim().split(" ")[0]).split(/\d+/g).filter(function(a){return a}).pop().trim();return{value:+a.split(b).filter(function(a){return a})[0].trim(),unit:b}}((a="tag-hide-transition",b.getPropertyValue("--"+a))))}},build:function c(a){var b=this.DOM;this.settings.mixMode.integrated?(b.originalInput=null,b.scope=a,b.input=a):(b.originalInput=a,b.scope=this.parseTemplate("wrapper",[a,this.settings]),b.input=b.scope.querySelector(this.settings.classNames.inputSelector),a.parentNode.insertBefore(b.scope,a))},destroy:function a(){this.DOM.scope.parentNode.removeChild(this.DOM.scope),this.dropdown.hide(!0),clearTimeout(this.dropdownHide__bindEventsTimeout)},loadOriginalValues:function d(a){var b,c=this.settings;if(!(void 0===a&&(a=c.mixMode.integrated?this.DOM.input.textContent:this.DOM.originalInput.value),this.removeAllTags({withoutChangeEvent:!0}),a))this.postUpdate();else if("mix"==c.mode)this.parseMixTags(a.trim()),(b=this.DOM.input.lastChild)&&"BR"==b.tagName||this.DOM.input.insertAdjacentHTML("beforeend","<br>");else{try{JSON.parse(a)instanceof Array&&(a=JSON.parse(a))}catch(a){}this.addTags(a).forEach(function(a){return a&&a.classList.add(c.classNames.tagNoAnimation)})}this.state.lastOriginalValueReported=c.mixMode.integrated?"":this.DOM.originalInput.value,this.state.loadedOriginalValues=!0},cloneEvent:function d(a){var b={};for(var c in a)b[c]=a[c];return b},loading:function b(a){return this.state.isLoading=a,this.DOM.scope.classList[a?"add":"remove"](this.settings.classNames.scopeLoading),this},tagLoading:function c(a,b){return a&&a.classList[b?"add":"remove"](this.settings.classNames.tagLoading),this},toggleClass:function c(a,b){"string"==typeof a&&this.DOM.scope.classList.toggle(a,b)},toggleFocusClass:function b(a){this.toggleClass(this.settings.classNames.focus,!!a)},triggerChangeEvent:function d(){if(!this.settings.mixMode.integrated){var a=this.DOM.originalInput,b=this.state.lastOriginalValueReported!==a.value,c=new CustomEvent("change",{bubbles:!0});b&&(this.state.lastOriginalValueReported=a.value,c.simulated=!0,a._valueTracker&&a._valueTracker.setValue(Math.random()),a.dispatchEvent(c),this.trigger("change",this.state.lastOriginalValueReported),a.value=this.state.lastOriginalValueReported)}},events:{customBinding:function b(){var a=this;this.customEventsList.forEach(function(b){a.on(b,a.settings.callbacks[b])})},binding:function a(){var b,c=!(0<arguments.length&&arguments[0]!==void 0)||arguments[0],d=this.events.callbacks,f=c?"addEventListener":"removeEventListener";if(!this.state.mainEvents||!c)for(var g in this.state.mainEvents=c,c&&!this.listeners.main&&(this.DOM.input.addEventListener(this.isIE?"keydown":"input",d[this.isIE?"onInputIE":"onInput"].bind(this)),window.addEventListener("keydown",d.onWindowKeyDown.bind(this)),this.settings.isJQueryPlugin&&jQuery(this.DOM.originalInput).on("tagify.removeAllTags",this.removeAllTags.bind(this))),b=this.listeners.main=this.listeners.main||{focus:["input",d.onFocusBlur.bind(this)],blur:["input",d.onFocusBlur.bind(this)],keydown:["input",d.onKeydown.bind(this)],click:["scope",d.onClickScope.bind(this)],dblclick:["scope",d.onDoubleClickScope.bind(this)],paste:["input",d.onPaste.bind(this)]})("blur"!=g||c)&&this.DOM[b[g][0]][f](g,b[g][1])},callbacks:{onFocusBlur:function k(b){var c=b.target?this.trim(b.target.textContent):"",d=this.settings,f=b.type,g=0<=d.dropdown.enabled,a={relatedTarget:b.relatedTarget},h=this.state.actions.selectOption&&(g||!d.dropdown.closeOnSelect),i=this.state.actions.addNew&&g,j=b.relatedTarget&&b.relatedTarget.classList.contains(d.classNames.tag)&&this.DOM.scope.contains(b.relatedTarget);if("blur"==f){if(b.relatedTarget===this.DOM.scope)return this.dropdown.hide(),void this.DOM.input.focus();this.postUpdate(),this.triggerChangeEvent()}if(!h&&!i)if(this.state.hasFocus="focus"==f&&+new Date,this.toggleFocusClass(this.state.hasFocus),"mix"!=d.mode){if("focus"==f)return this.trigger("focus",a),void(0===d.dropdown.enabled&&this.dropdown.show());"blur"==f&&(this.trigger("blur",a),this.loading(!1),"select"==this.settings.mode&&j&&(c=""),("select"==this.settings.mode&&c?!this.value.length||this.value[0].value!=c:c&&!this.state.actions.selectOption&&d.addTagOnBlur)&&this.addTags(c,!0),"select"!=this.settings.mode||c||this.removeTags()),this.DOM.input.removeAttribute("style"),this.dropdown.hide()}else"focus"==f?this.trigger("focus",a):"blur"==b.type&&(this.trigger("blur",a),this.loading(!1),this.dropdown.hide(),this.state.dropdown.visible=void 0,this.setStateSelection())},onWindowKeyDown:function d(a){var b,c=document.activeElement;if(c.classList.contains(this.settings.classNames.tag)&&this.DOM.scope.contains(document.activeElement))switch(b=c.nextElementSibling,a.key){case"Backspace":this.removeTags(c),(b||this.DOM.input).focus();break;case"Enter":setTimeout(this.editTag.bind(this),0,c);}},onKeydown:function c(b){var h=this,j=this.trim(b.target.textContent);if(this.trigger("keydown",{originalEvent:this.cloneEvent(b)}),"mix"==this.settings.mode){switch(b.key){case"Left":case"ArrowLeft":this.state.actions.ArrowLeft=!0;break;case"Delete":case"Backspace":if(this.state.editing)return;var e,m,n,p=document.getSelection(),q="Delete"==b.key&&p.anchorOffset==(p.anchorNode.length||0),l=1==p.anchorNode.nodeType||!p.anchorOffset&&p.anchorNode.previousElementSibling,d=k(this.DOM.input.innerHTML),g=this.getTagElms();if("edit"==this.settings.backspace&&l)return e=1==p.anchorNode.nodeType?null:p.anchorNode.previousElementSibling,setTimeout(this.editTag.bind(this),0,e),void b.preventDefault();if(w()&&l)return n=a(l),l.hasAttribute("readonly")||l.remove(),this.DOM.input.focus(),void setTimeout(function(){h.placeCaretAfterNode(n),h.DOM.input.click()});if("BR"==p.anchorNode.nodeName)return;if((q||l)&&1==p.anchorNode.nodeType?m=0==p.anchorOffset?q?g[0]:null:g[p.anchorOffset-1]:q?m=p.anchorNode.nextElementSibling:l&&(m=l),3==p.anchorNode.nodeType&&!p.anchorNode.nodeValue&&p.anchorNode.previousElementSibling&&b.preventDefault(),(l||q)&&!this.settings.backspace)return void b.preventDefault();if("Range"!=p.type&&!p.anchorOffset&&p.anchorNode==this.DOM.input&&"Delete"!=b.key)return void b.preventDefault();if("Range"!=p.type&&m&&m.hasAttribute("readonly"))return void this.placeCaretAfterNode(a(m));clearTimeout(f),f=setTimeout(function(){var a=document.getSelection(),b=k(h.DOM.input.innerHTML),c=a.anchorNode.previousElementSibling;return!w()&&b.length>=d.length&&c&&!c.hasAttribute("readonly")&&(h.removeTags(c),h.fixFirefoxLastTagNoCaret(),2==h.DOM.input.children.length&&"BR"==h.DOM.input.children[1].tagName)?(h.DOM.input.innerHTML="",h.value.length=0,!0):void(h.value=[].map.call(g,function(a,b){var c=h.tagData(a);return a.parentNode||c.readonly?c:void h.trigger("remove",{tag:a,index:b,data:c})}).filter(function(a){return a}))},20);}return!0}switch(b.key){case"Backspace":this.state.dropdown.visible&&"manual"!=this.settings.dropdown.position||""!=j&&8203!=j.charCodeAt(0)||(!0===this.settings.backspace?this.removeTags():"edit"==this.settings.backspace&&setTimeout(this.editTag.bind(this),0));break;case"Esc":case"Escape":if(this.state.dropdown.visible)return;b.target.blur();break;case"Down":case"ArrowDown":this.state.dropdown.visible||this.dropdown.show();break;case"ArrowRight":{var r=this.state.inputSuggestion||this.state.ddItemData;if(r&&this.settings.autoComplete.rightKey)return void this.addTags([r],!0);break}case"Tab":{var t="select"==this.settings.mode;if(!j||t)return!0;b.preventDefault()}case"Enter":if(this.state.dropdown.visible||229==b.keyCode)return;b.preventDefault(),setTimeout(function(){h.state.actions.selectOption||h.addTags(j,!0)});}},onInput:function e(a){if("mix"==this.settings.mode)return this.events.callbacks.onMixTagsInput.call(this,a);var b=this.input.normalize.call(this),c=b.length>=this.settings.dropdown.enabled,d={value:b,inputElm:this.DOM.input};d.isValid=this.validateTag({value:b}),this.state.inputText!=b&&(this.input.set.call(this,b,!1),-1==b.search(this.settings.delimiters)?0<=this.settings.dropdown.enabled&&this.dropdown[c?"show":"hide"](b):this.addTags(b)&&this.input.set.call(this),this.trigger("input",d))},onMixTagsInput:function B(b){var f,h,j,k,l,q,t,x,y=this,z=this.settings,g=this.value.length,p=this.getTagElms(),c=document.createDocumentFragment(),u=window.getSelection().getRangeAt(0),A=[].map.call(p,function(a){return y.tagData(a).value});if("deleteContentBackward"==b.inputType&&w()&&this.events.callbacks.onKeydown.call(this,{target:b.target,key:"Backspace"}),this.value.slice().forEach(function(a){a.readonly&&!A.includes(a.value)&&c.appendChild(y.createTagElem(a))}),c.childNodes.length&&(u.insertNode(c),this.setRangeAtStartEnd(!1,c.lastChild)),p.length!=g)return this.value=[].map.call(this.getTagElms(),function(a){return y.tagData(a)}),void this.update({withoutChangeEvent:!0});if(this.hasMaxTags())return!0;if(window.getSelection&&0<(q=window.getSelection()).rangeCount&&3==q.anchorNode.nodeType){if((u=q.getRangeAt(0).cloneRange()).collapse(!0),u.setStart(q.focusNode,0),j=(f=u.toString().slice(0,u.endOffset)).split(z.pattern).length-1,(h=f.match(z.pattern))&&(k=f.slice(f.lastIndexOf(h[h.length-1]))),k){if(this.state.actions.ArrowLeft=!1,this.state.tag={prefix:k.match(z.pattern)[0],value:k.replace(z.pattern,"")},this.state.tag.baseOffset=q.baseOffset-this.state.tag.value.length,x=this.state.tag.value.match(z.delimiters))return this.state.tag.value=this.state.tag.value.replace(z.delimiters,""),this.state.tag.delimiters=x[0],this.addTags(this.state.tag.value,z.dropdown.clearOnSelect),void this.dropdown.hide();l=this.state.tag.value.length>=z.dropdown.enabled;try{t=(t=this.state.flaggedTags[this.state.tag.baseOffset]).prefix==this.state.tag.prefix&&t.value[0]==this.state.tag.value[0],this.state.flaggedTags[this.state.tag.baseOffset]&&!this.state.tag.value&&delete this.state.flaggedTags[this.state.tag.baseOffset]}catch(a){}(t||j<this.state.mixMode.matchedPatternCount)&&(l=!1)}else this.state.flaggedTags={};this.state.mixMode.matchedPatternCount=j}setTimeout(function(){y.update({withoutChangeEvent:!0}),y.trigger("input",v({},y.state.tag,{textContent:y.DOM.input.textContent})),y.state.tag&&y.dropdown[l?"show":"hide"](y.state.tag.value)},10)},onInputIE:function c(a){var b=this;setTimeout(function(){b.events.callbacks.onInput.call(b,a)})},onClickScope:function e(a){var b=this.settings,c=a.target.closest("."+b.classNames.tag),d=+new Date-this.state.hasFocus;if(a.target!=this.DOM.scope){if(!a.target.classList.contains(b.classNames.tagX))return c?(this.trigger("click",{tag:c,index:this.getNodeIndex(c),data:this.tagData(c),originalEvent:this.cloneEvent(a)}),void(1!==b.editTags&&1!==b.editTags.clicks||this.events.callbacks.onDoubleClickScope.call(this,a))):void(a.target==this.DOM.input&&("mix"==b.mode&&this.fixFirefoxLastTagNoCaret(),500<d)?this.state.dropdown.visible?this.dropdown.hide():0===b.dropdown.enabled&&"mix"!=b.mode&&this.dropdown.show():"select"==b.mode&&!this.state.dropdown.visible&&this.dropdown.show());this.removeTags(a.target.parentNode)}else this.state.hasFocus||this.DOM.input.focus()},onPaste:function f(a){var b,c,d=this;a.preventDefault(),this.settings.readonly||(b=a.clipboardData||window.clipboardData,c=b.getData("Text"),this.settings.hooks.beforePaste(a,{tagify:this,pastedText:c,clipboardData:b}).then(function(b){void 0===b&&(b=c),b&&(d.injectAtCaret(b,window.getSelection().getRangeAt(0)),"mix"==d.settings.mode?d.events.callbacks.onMixTagsInput.call(d,a):d.settings.pasteAsTags?d.addTags(b,!0):d.state.inputText=b)}).catch(function(a){return a}))},onEditTagInput:function i(b,c){var d=b.closest("."+this.settings.classNames.tag),e=this.getNodeIndex(d),f=this.tagData(d),a=this.input.normalize.call(this,b),g=d.innerHTML!=d.__tagifyTagData.__originalHTML,h=this.validateTag(_defineProperty({},this.settings.tagTextProp,a));g||!0!==b.originalIsValid||(h=!0),d.classList.toggle(this.settings.classNames.tagInvalid,!0!==h),f.__isValid=h,d.title=!0===h?f.title||f.value:h,a.length>=this.settings.dropdown.enabled&&(this.state.editing&&(this.state.editing.value=a),this.dropdown.show(a)),this.trigger("edit:input",{tag:d,index:e,data:v({},this.value[e],{newValue:a}),originalEvent:this.cloneEvent(c)})},onEditTagFocus:function b(a){this.state.editing={scope:a,input:a.querySelector("[contenteditable]")}},onEditTagBlur:function n(b){if(this.state.hasFocus||this.toggleFocusClass(),this.DOM.scope.contains(b)){var c,f,g=this.settings,h=b.closest("."+g.classNames.tag),a=this.input.normalize.call(this,b),j=this.tagData(h).__originalData,k=h.innerHTML!=h.__tagifyTagData.__originalHTML,l=this.validateTag(_defineProperty({},g.tagTextProp,a));if(!a)this.onEditTagDone(h);else if(k){var m;if(c=this.hasMaxTags(),f=this.getWhitelistItem(a)||v({},j,(m={},_defineProperty(m,g.tagTextProp,a),_defineProperty(m,"value",a),_defineProperty(m,"__isValid",l),m)),g.transformTag.call(this,f,j),!0!==(l=!c&&this.validateTag(_defineProperty({},g.tagTextProp,f[g.tagTextProp])))){if(this.trigger("invalid",{data:f,tag:h,message:l}),g.editTags.keepInvalid)return;g.keepInvalidTags?f.__isValid=l:f=j}else g.keepInvalidTags&&(delete f.title,delete f["aria-invalid"],delete f.class);this.onEditTagDone(h,f)}else this.onEditTagDone(h,j)}},onEditTagkeydown:function c(a,b){switch(this.trigger("edit:keydown",{originalEvent:this.cloneEvent(a)}),a.key){case"Esc":case"Escape":b.innerHTML=b.__tagifyTagData.__originalHTML;case"Enter":case"Tab":a.preventDefault(),a.target.blur();}},onDoubleClickScope:function a(b){var c,d,f=b.target.closest("."+this.settings.classNames.tag),g=this.settings;f&&(c=f.classList.contains(this.settings.classNames.tagEditing),d=f.hasAttribute("readonly"),"select"==g.mode||g.readonly||c||d||!this.settings.editTags||this.editTag(f),this.toggleFocusClass(!0),this.trigger("dblclick",{tag:f,index:this.getNodeIndex(f),data:this.tagData(f)}))}}},fixFirefoxLastTagNoCaret:function a(){},placeCaretAfterNode:function e(a){if(a&&a.parentNode){var b=a.nextSibling,c=window.getSelection(),d=c.getRangeAt(0);c.rangeCount&&(d.setStartBefore(b||a),d.setEndBefore(b||a),c.removeAllRanges(),c.addRange(d))}},insertAfterTag:function c(a,b){if(b=b||this.settings.mixMode.insertAfterTag,a&&a.parentNode&&b)return b="string"==typeof b?document.createTextNode(b):b,a.parentNode.insertBefore(b,a.nextSibling),b},editTag:function n(b,c){var g=this;function f(){return b.querySelector(j.classNames.tagTextSelector)}b=b||this.getLastTag(),c=c||{},this.dropdown.hide();var j=this.settings,i=f(),a=this.getNodeIndex(b),k=this.tagData(b),l=this.events.callbacks,m=this,d=!0;if(!i)console.warn("Cannot find element in Tag template: .",j.classNames.tagTextSelector);else if(!(k instanceof Object&&"editable"in k)||k.editable)return i.setAttribute("contenteditable",!0),b.classList.add(j.classNames.tagEditing),this.tagData(b,{__originalData:v({},k),__originalHTML:b.innerHTML}),i.addEventListener("focus",l.onEditTagFocus.bind(this,b)),i.addEventListener("blur",function(){setTimeout(function(){return l.onEditTagBlur.call(m,f())})}),i.addEventListener("input",l.onEditTagInput.bind(this,i)),i.addEventListener("keydown",function(a){return l.onEditTagkeydown.call(g,a,b)}),i.focus(),this.setRangeAtStartEnd(!1,i),c.skipValidation||(d=this.editTagToggleValidity(b)),i.originalIsValid=d,this.trigger("edit:start",{tag:b,index:a,data:k,isValid:d}),this},editTagToggleValidity:function d(a,b){var c;return(b=b||this.tagData(a))?((c=!("__isValid"in b)||!0===b.__isValid)||this.removeTagsFromValue(a),this.update(),a.classList.toggle(this.settings.classNames.tagNotAllowed,!c),b.__isValid):void console.warn("tag has no data: ",a,b)},onEditTagDone:function d(a,b){b=b||{};var c={tag:a=a||this.state.editing.scope,index:this.getNodeIndex(a),previousData:this.tagData(a),data:b};this.trigger("edit:beforeUpdate",c,{cloneData:!1}),this.state.editing=!1,delete b.__originalData,delete b.__originalHTML,a&&b[this.settings.tagTextProp]?(a=this.replaceTag(a,b),this.editTagToggleValidity(a,b),this.settings.a11y.focusableTags&&a.focus()):a&&this.removeTags(a),this.trigger("edit:updated",c),this.dropdown.hide(),this.settings.keepInvalidTags&&this.reCheckInvalidTags()},replaceTag:function d(a,b){b&&b.value||(b=a.__tagifyTagData),b.__isValid&&1!=b.__isValid&&v(b,this.getInvalidTagAttrs(b,b.__isValid));var c=this.createTagElem(b);return a.parentNode.replaceChild(c,a),this.updateValueByDOMTags(),c},updateValueByDOMTags:function b(){var a=this;this.value.length=0,[].forEach.call(this.getTagElms(),function(b){b.classList.contains(a.settings.classNames.tagNotAllowed.split(" ")[0])||a.value.push(a.tagData(b))}),this.update()},setRangeAtStartEnd:function d(a,b){a="number"==typeof a?a:!!a,b=(b=b||this.DOM.input).lastChild||b;var c=document.getSelection();try{1<=c.rangeCount&&["Start","End"].forEach(function(d){return c.getRangeAt(0)["set"+d](b,a||b.length)})}catch(a){console.warn("Tagify: ",a)}},injectAtCaret:function c(a,b){if(b=b||this.state.selection.range)return"string"==typeof a&&(a=document.createTextNode(a)),b.deleteContents(),b.insertNode(a),this.setRangeAtStartEnd(!1,a),this.updateValueByDOMTags(),this.update(),this},input:{set:function d(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"",b=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],c=this.settings.dropdown.closeOnSelect;this.state.inputText=a,b&&(this.DOM.input.innerHTML=m(""+a)),!a&&c&&this.dropdown.hide.bind(this),this.input.autocomplete.suggest.call(this),this.input.validate.call(this)},validate:function b(){var a=!this.state.inputText||!0===this.validateTag({value:this.state.inputText});return this.DOM.input.classList.toggle(this.settings.classNames.inputInvalid,!a),a},normalize:function d(a){var b=a||this.DOM.input,c=[];b.childNodes.forEach(function(a){return 3==a.nodeType&&c.push(a.nodeValue)}),c=c.join("\n");try{c=c.replace(/(?:\r\n|\r|\n)/g,this.settings.delimiters.source.charAt(0))}catch(a){}return c=c.replace(/\s/g," "),this.settings.trim&&(c=c.replace(/^\s+/,"")),c},autocomplete:{suggest:function e(a){if(this.settings.autoComplete.enabled){"string"==typeof(a=a||{})&&(a={value:a});var b=a.value?""+a.value:"",c=b.substr(0,this.state.inputText.length).toLowerCase(),d=b.substring(this.state.inputText.length);b&&this.state.inputText&&c==this.state.inputText.toLowerCase()?(this.DOM.input.setAttribute("data-suggest",d),this.state.inputSuggestion=a):(this.DOM.input.removeAttribute("data-suggest"),delete this.state.inputSuggestion)}},set:function d(a){var b=this.DOM.input.getAttribute("data-suggest"),c=a||(b?this.state.inputText+b:null);return!!c&&("mix"==this.settings.mode?this.replaceTextWithNode(document.createTextNode(this.state.tag.prefix+c)):(this.input.set.call(this,c),this.setRangeAtStartEnd()),this.input.autocomplete.suggest.call(this),this.dropdown.hide(),!0)}}},getTagIdx:function b(a){return this.value.findIndex(function(b){return b.__tagId==(a||{}).__tagId})},getNodeIndex:function c(a){var b=0;if(a)for(;a=a.previousElementSibling;)b++;return b},getTagElms:function e(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];var d="."+[].concat(_toConsumableArray(this.settings.classNames.tag.split(" ")),_toConsumableArray(b)).join(".");return[].slice.call(this.DOM.scope.querySelectorAll(d))},getLastTag:function b(){var a=this.DOM.scope.querySelectorAll(this.settings.classNames.tagSelector+":not(."+this.settings.classNames.tagHide+"):not([readonly])");return a[a.length-1]},tagData:function d(a,b,c){return a?(b&&(a.__tagifyTagData=c?b:v({},a.__tagifyTagData||{},b)),a.__tagifyTagData):(console.warn("tag elment doesn't exist",a,b),b)},isTagDuplicate:function a(b,c){var d=this,e=this.settings;return"select"!=e.mode&&this.value.reduce(function(f,a){return g(d.trim(""+b),a.value,c||e.dropdown.caseSensitive)?f+1:f},0)},getTagIndexByValue:function a(b){var c=this,d=[];return this.getTagElms().forEach(function(e,f){g(c.trim(e.textContent),b,c.settings.dropdown.caseSensitive)&&d.push(f)}),d},getTagElmByValue:function c(a){var b=this.getTagIndexByValue(a)[0];return this.getTagElms()[b]},flashTag:function c(a){var b=this;a&&(a.classList.add(this.settings.classNames.tagFlash),setTimeout(function(){a.classList.remove(b.settings.classNames.tagFlash)},100))},isTagBlacklisted:function b(a){return a=this.trim(a.toLowerCase()),this.settings.blacklist.filter(function(b){return(""+b).toLowerCase()==a}).length},isTagWhitelisted:function b(a){return!!this.getWhitelistItem(a)},getWhitelistItem:function i(b,c,d){c=c||"value";var f,h=this.settings;return(d=d||h.whitelist).some(function(a){var d="string"==typeof a?a:a[c]||a.value;if(g(d,b,h.dropdown.caseSensitive,h.trim))return f="string"==typeof a?{value:a}:a,!0}),f||"value"!=c||"value"==h.tagTextProp||(f=this.getWhitelistItem(b,h.tagTextProp,d)),f},validateTag:function e(a){var b=this.settings,c="value"in a?"value":b.tagTextProp,d=this.trim(a[c]+"");return(a[c]+"").trim()?b.pattern&&b.pattern instanceof RegExp&&!b.pattern.test(d)?this.TEXTS.pattern:!b.duplicates&&this.isTagDuplicate(d,this.state.editing)?this.TEXTS.duplicate:this.isTagBlacklisted(d)||b.enforceWhitelist&&!this.isTagWhitelisted(d)?this.TEXTS.notAllowed:!b.validate||b.validate(a):this.TEXTS.empty},getInvalidTagAttrs:function c(a,b){return{"aria-invalid":!0,class:((a.class||"")+" "+this.settings.classNames.tagNotAllowed).trim(),title:b}},hasMaxTags:function a(){return this.value.length>=this.settings.maxTags&&this.TEXTS.exceed},setReadonly:function d(a,b){var c=this.settings;document.activeElement.blur(),c[b||"readonly"]=a,this.DOM.scope[(a?"set":"remove")+"Attribute"](b||"readonly",!0),"mix"==c.mode&&(this.DOM.input.contentEditable=!a)},setDisabled:function b(a){this.setReadonly(a,"disabled")},normalizeTags:function d(b){var c,f=this,g=this.settings,e=g.whitelist,h=g.delimiters,j=g.mode,a=g.tagTextProp;g.enforceWhitelist;var k=[],i=!!e&&e[0]instanceof Object,m=b instanceof Array,l=function(b){return(b+"").split(h).filter(function(a){return a}).map(function(b){var c;return c={},_defineProperty(c,a,f.trim(b)),_defineProperty(c,"value",f.trim(b)),c})};if("number"==typeof b&&(b=b.toString()),"string"==typeof b){if(!b.trim())return[];b=l(b)}else m&&(b=(c=[]).concat.apply(c,_toConsumableArray(b.map(function(a){return a.value?a:l(a)}))));return i&&(b.forEach(function(b){var c=k.map(function(a){return a.value}),d=f.dropdown.filterListItems.call(f,b[a],{exact:!0}).filter(function(a){return!c.includes(a.value)}),e=1<d.length?f.getWhitelistItem(b[a],a,d):d[0];e&&e instanceof Object?k.push(e):"mix"!=j&&(null==b.value&&(b.value=b[a]),k.push(b))}),b=k),b},parseMixTags:function c(b){var f=this,g=this.settings,j=g.mixTagsInterpolator,i=g.duplicates,k=g.transformTag,a=g.enforceWhitelist,m=g.maxTags,n=g.tagTextProp,o=[];return b=b.split(j[0]).map(function(b,l){var e,q,r,s=b.split(j[1]),p=s[0],c=o.length==m;try{if(p==+p)throw Error;q=JSON.parse(p)}catch(a){q=f.normalizeTags(p)[0]||{value:p}}if(!(c||!(1<s.length)||a&&!f.isTagWhitelisted(q.value)||!i&&f.isTagDuplicate(q.value)))k.call(f,q),q[e=q[n]?n:"value"]=f.trim(q[e]),r=f.createTagElem(q),o.push(q),r.classList.add(f.settings.classNames.tagNoAnimation),s[0]=r.outerHTML,f.value.push(q);else if(b)return l?j[0]+b:b;return s.join("")}).join(""),this.DOM.input.innerHTML=b,this.DOM.input.appendChild(document.createTextNode("")),this.DOM.input.normalize(),this.getTagElms().forEach(function(a,b){return f.tagData(a,o[b])}),this.update({withoutChangeEvent:!0}),b},replaceTextWithNode:function j(b,c){if(this.state.tag||c){c=c||this.state.tag.prefix+this.state.tag.value;var d,f,g=window.getSelection(),a=g.anchorNode,h=this.state.tag.delimiters?this.state.tag.delimiters.length:0;return a.splitText(g.anchorOffset-h),d=a.nodeValue.lastIndexOf(c),f=a.splitText(d),b&&a.parentNode.replaceChild(b,f),!0}},selectTag:function d(a,b){if(!this.settings.enforceWhitelist||this.isTagWhitelisted(b.value)){this.input.set.call(this,b[this.settings.tagTextProp||"value"],!0),this.state.actions.selectOption&&setTimeout(this.setRangeAtStartEnd.bind(this));var c=this.getLastTag();return c?this.replaceTag(c,b):this.appendTag(a),this.value[0]=b,this.trigger("add",{tag:a,data:b}),this.update(),[a]}},addEmptyTag:function d(a){var b=v({value:""},a||{}),c=this.createTagElem(b);this.tagData(c,b),this.appendTag(c),this.editTag(c,{skipValidation:!0})},addTags:function i(b,c){var d=this,f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:this.settings.skipInvalid,g=[],h=this.settings,a=document.createDocumentFragment();return b&&0!=b.length?(b=this.normalizeTags(b),"mix"==h.mode?this.addMixTags(b):("select"==h.mode&&(c=!1),this.DOM.input.removeAttribute("style"),b.forEach(function(b){var c,i={},j=Object.assign({},b,{value:b.value+""});if((b=Object.assign({},j)).__isValid=d.hasMaxTags()||d.validateTag(b),h.transformTag.call(d,b),!0!==b.__isValid){if(f)return;v(i,d.getInvalidTagAttrs(b,b.__isValid),{__preInvalidData:j}),b.__isValid==d.TEXTS.duplicate&&d.flashTag(d.getTagElmByValue(b.value))}return(b.readonly&&(i["aria-readonly"]=!0),c=d.createTagElem(b,i),g.push(c),"select"==h.mode)?d.selectTag(c,b):void(a.appendChild(c),b.__isValid&&!0===b.__isValid?(d.value.push(b),d.trigger("add",{tag:c,index:d.value.length-1,data:b})):(d.trigger("invalid",{data:b,index:d.value.length,tag:c,message:b.__isValid}),h.keepInvalidTags||setTimeout(function(){return d.removeTags(c,!0)},1e3)),d.dropdown.position())}),this.appendTag(a),this.update(),b.length&&c&&this.input.set.call(this),this.dropdown.refilter(),g)):("select"==h.mode&&this.removeAllTags(),g)},addMixTags:function f(a){var b=this;if(a[0].prefix||this.state.tag)this.prefixedTextToTag(a[0]);else{"string"==typeof a&&(a=[{value:a}]);var c=!!this.state.selection,d=document.createDocumentFragment();a.forEach(function(a){var c=b.createTagElem(a);d.appendChild(c),b.insertAfterTag(c)}),c?this.injectAtCaret(d):(this.DOM.input.focus(),(c=this.setStateSelection()).range.setStart(this.DOM.input,c.range.endOffset),c.range.setEnd(this.DOM.input,c.range.endOffset),this.DOM.input.appendChild(d),this.updateValueByDOMTags(),this.update())}},prefixedTextToTag:function a(b){var c,d=this,f=this.settings,g=this.state.tag.delimiters;if(f.transformTag.call(this,b),b.prefix=b.prefix||this.state.tag?this.state.tag.prefix:(f.pattern.source||f.pattern)[0],c=this.createTagElem(b),this.replaceTextWithNode(c)||this.DOM.input.appendChild(c),setTimeout(function(){return c.classList.add(d.settings.classNames.tagNoAnimation)},300),this.value.push(b),this.update(),!g){var h=this.insertAfterTag(c)||c;this.placeCaretAfterNode(h)}return this.state.tag=null,this.trigger("add",v({},{tag:c},{data:b})),c},appendTag:function d(a){var b=this.DOM,c=b.scope.lastElementChild;c===b.input?b.scope.insertBefore(a,c):b.scope.appendChild(a)},createTagElem:function h(d,e){d.__tagId="10000000-1000-4000-8000-100000000000".replace(/[018]/g,function(a){return(a^crypto.getRandomValues(new Uint8Array(1))[0]&15>>a/4).toString(16)});var f,g=v({},d,function(d){for(var f,e=1;e<arguments.length;e++)f=null==arguments[e]?{}:arguments[e],e%2?c(Object(f),!0).forEach(function(a){b(d,a,f[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(f)):c(Object(f)).forEach(function(a){Object.defineProperty(d,a,Object.getOwnPropertyDescriptor(f,a))});return d}({value:m(d.value+"")},e));return function(a){for(var b,c=document.createNodeIterator(a,NodeFilter.SHOW_TEXT,null,!1);b=c.nextNode();)b.textContent.trim()||b.parentNode.removeChild(b)}(f=this.parseTemplate("tag",[g])),this.tagData(f,d),f},reCheckInvalidTags:function a(){var b=this,c=this.settings;this.getTagElms(c.classNames.tagNotAllowed).forEach(function(c){var d=b.tagData(c),e=b.hasMaxTags(),f=b.validateTag(d);return!0!==f||e?void(c.title=e||f):(d=d.__preInvalidData?d.__preInvalidData:{value:d.value},b.replaceTag(c,d))})},removeTags:function g(a,b,c){var d,f=this;a=a&&a instanceof HTMLElement?[a]:a instanceof Array?a:a?[a]:[this.getLastTag()],d=a.reduce(function(a,b){return b&&"string"==typeof b&&(b=f.getTagElmByValue(b)),b&&f.tagData(b)&&a.push({node:b,idx:f.getTagIdx(f.tagData(b)),data:f.tagData(b,{__removed:!0})}),a},[]),c="number"==typeof c?c:this.CSSVars.tagHideTransition,"select"==this.settings.mode&&(c=0,this.input.set.call(this)),1==d.length&&d[0].node.classList.contains(this.settings.classNames.tagNotAllowed)&&(b=!0),d.length&&this.settings.hooks.beforeRemoveTag(d,{tagify:this}).then(function(){function a(a){a.node.parentNode&&(a.node.parentNode.removeChild(a.node),b?this.settings.keepInvalidTags&&this.trigger("remove",{tag:a.node,index:a.idx}):(this.trigger("remove",{tag:a.node,index:a.idx,data:a.data}),this.dropdown.refilter(),this.dropdown.position(),this.DOM.input.normalize(),this.settings.keepInvalidTags&&this.reCheckInvalidTags()))}c&&10<c&&1==d.length?function(b){b.node.style.width=parseFloat(window.getComputedStyle(b.node).width)+"px",document.body.clientTop,b.node.classList.add(this.settings.classNames.tagHide),setTimeout(a.bind(this),c,b)}.call(f,d[0]):d.forEach(a.bind(f)),b||(f.removeTagsFromValue(d.map(function(a){return a.node})),f.update())}).catch(function(){})},removeTagsFromDOM:function a(){[].slice.call(this.getTagElms()).forEach(function(a){return a.parentNode.removeChild(a)})},removeTagsFromValue:function c(a){var b=this;(a=Array.isArray(a)?a:[a]).forEach(function(a){var c=b.tagData(a),d=b.getTagIdx(c);-1<d&&b.value.splice(d,1)})},removeAllTags:function b(a){a=a||{},this.value=[],"mix"==this.settings.mode?this.DOM.input.innerHTML="":this.removeTagsFromDOM(),this.dropdown.position(),"select"==this.settings.mode&&this.input.set.call(this),this.update(a)},postUpdate:function c(){var a=this.settings.classNames,b="mix"==this.settings.mode?this.settings.mixMode.integrated?this.DOM.input.textContent:this.DOM.originalInput.value:this.value.length;this.toggleClass(a.hasMaxTags,this.value.length>=this.settings.maxTags),this.toggleClass(a.hasNoTags,!this.value.length),this.toggleClass(a.empty,!b)},update:function c(a){var b=this.DOM.originalInput;this.settings.mixMode.integrated||(b.value=this.getInputValue()),this.postUpdate(),!(a||{}).withoutChangeEvent&&this.state.loadedOriginalValues&&this.triggerChangeEvent()},getInputValue:function b(){var a=this.getCleanValue();return"mix"==this.settings.mode?this.getMixedTagsAsString(a):a.length?this.settings.originalInputValueFormat?this.settings.originalInputValueFormat(a):JSON.stringify(a):""},getCleanValue:function d(a){return b=a||this.value,c=this.dataProps,b&&Array.isArray(b)&&b.map(function(a){return j(a,c)});var b,c},getMixedTagsAsString:function a(){var b="",c=this,d=this.settings.mixTagsInterpolator;return function e(a){a.childNodes.forEach(function(a){if(1==a.nodeType){var f=c.tagData(a);if(a.classList.contains(c.settings.classNames.tag)&&f)return f.__removed?void 0:void(b+=d[0]+JSON.stringify(j(f,c.dataProps))+d[1]);"BR"!=a.tagName||a.parentNode!=c.DOM.input&&1!=a.parentNode.childNodes.length?"DIV"!=a.tagName&&"P"!=a.tagName||(b+="\r\n",e(a)):b+="\r\n"}else b+=a.textContent})}(this.DOM.input),b}},e.prototype.removeTag=e.prototype.removeTags,e});