"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}/**
 * Tagify (v 4.9.7) - tags input component
 * By Yair Even-Or
 * Don't sell this code. (c)
 * https://github.com/yairEO/tagify
 */(function(a){// just a jQuery wrapper for the vanilla version of this component
/**
 * Tagify (v 4.9.7) - tags input component
 * By Yair Even-Or
 * Don't sell this code. (c)
 * https://github.com/yairEO/tagify
 */a.fn.tagify=function(){var b=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};return this.each(function(){var c,d=a(this);return d.data("tagify")?this:void(b.isJQueryPlugin=!0,c=new Tagify(d[0],b),d.data("tagify",c))})},!function(a,b){"object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):(a="undefined"==typeof globalThis?a||self:globalThis).Tagify=b()}(this,function(){"use strict";function b(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function j(c){for(var d,e=1;e<arguments.length;e++)d=null==arguments[e]?{}:arguments[e],e%2?b(Object(d),!0).forEach(function(a){k(c,a,d[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(d)):b(Object(d)).forEach(function(a){Object.defineProperty(c,a,Object.getOwnPropertyDescriptor(d,a))});return c}function k(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function m(a,b){var c,d={};for(c in a)0>b.indexOf(c)&&(d[c]=a[c]);return d}function q(a){var b=document.createElement("div");return a.replace(/\&#?[0-9a-z]+;/gi,function(a){return b.innerHTML=a,b.innerText})}function i(a,b){for(b=b||"previous";a=a[b+"Sibling"];)if(3==a.nodeType)return a}function n(a){return"string"==typeof a?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/`|'/g,"&#039;"):a}function w(a){var b=Object.prototype.toString.call(a).split(" ")[1].slice(0,-1);return a===Object(a)&&"Array"!=b&&"Function"!=b&&"RegExp"!=b&&"HTMLUnknownElement"!=b}function v(a,b,c){function d(a,b){for(var c in b)if(b.hasOwnProperty(c)){if(w(b[c])){w(a[c])?d(a[c],b[c]):a[c]=Object.assign({},b[c]);continue}if(Array.isArray(b[c])){a[c]=Object.assign([],b[c]);continue}a[c]=b[c]}}return a instanceof Object||(a={}),d(a,b),c&&d(a,c),a}function l(a){return String.prototype.normalize?"string"==typeof a?a.normalize("NFD").replace(/[\u0300-\u036f]/g,""):void 0:a}function h(a){return a&&a.classList&&a.classList.contains(this.settings.classNames.tag)}function a(){for(var a in this.dropdown={},this._dropdown)this.dropdown[a]="function"==typeof this._dropdown[a]?this._dropdown[a].bind(this):this._dropdown[a];this.dropdown.refs()}function c(b,c){if(!b){console.warn("Tagify:","input element not found",b);var f=new Proxy(this,{get:function a(){return function(){return f}}});return f}if(b.previousElementSibling&&b.previousElementSibling.classList.contains("tagify"))return console.warn("Tagify: ","input element is already Tagified",b),this;var d;v(this,function(b){function a(a,b,d){d&&b.split(/\s+/g).forEach(function(b){return c[a+"EventListener"].call(c,b,d)})}var c=document.createTextNode("");return{off:function d(b,c){return a("remove",b,c),this},on:function d(b,c){return c&&"function"==typeof c&&a("add",b,c),this},trigger:function k(d,e,f){var g;if(f=f||{cloneData:!0},d)if(b.settings.isJQueryPlugin)"remove"==d&&(d="removeTag"),jQuery(b.DOM.originalInput).triggerHandler(d,[e]);else{try{var h="object"==("undefined"==typeof e?"undefined":_typeof(e))?e:{value:e};if((h=f.cloneData?v({},h):h).tagify=this,e instanceof Object)for(var j in e)e[j]instanceof HTMLElement&&(h[j]=e[j]);g=new CustomEvent(d,{detail:h})}catch(a){console.warn(a)}c.dispatchEvent(g)}}}}(this)),this.isFirefox="undefined"!=typeof InstallTrigger,this.isIE=window.document.documentMode,c=c||{},this.getPersistedData=(d=c.id,function(a){var b;if(1==localStorage.getItem("@yaireo/tagify/"+d+"/v",1))try{b=JSON.parse(localStorage["@yaireo/tagify/"+d+("/"+a)])}catch(a){}return b}),this.setPersistedData=function(b){return b?(localStorage.setItem("@yaireo/tagify/"+b+"/v",1),function(c,d){var e=JSON.stringify(c);c&&d&&(localStorage.setItem("@yaireo/tagify/"+b+("/"+d),e),dispatchEvent(new Event("storage")))}):function(){}}(c.id),this.clearPersistedData=function(a){return function(b){var c="@yaireo/tagify//"+a+"/";if(b)localStorage.removeItem(c+b);else for(var d in localStorage)d.includes(c)&&localStorage.removeItem(d)}}(c.id),this.applySettings(b,c),this.state={inputText:"",editing:!1,actions:{},mixMode:{},dropdown:{},flaggedTags:{}},this.value=[],this.listeners={},this.DOM={},this.build(b),a.call(this),this.getCSSVars(),this.loadOriginalValues(),this.events.customBinding.call(this),this.events.binding.call(this),b.autofocus&&this.DOM.input.focus()}var o,d=function(a,b,c,d){return a=""+a,b=""+b,d&&(a=a.trim(),b=b.trim()),c?a==b:a.toLowerCase()==b.toLowerCase()},x=function(){return /(?=.*chrome)(?=.*android)/i.test(navigator.userAgent)},e={delimiters:",",pattern:null,tagTextProp:"value",maxTags:1/0,callbacks:{},addTagOnBlur:!0,duplicates:!1,whitelist:[],blacklist:[],enforceWhitelist:!1,userInput:!0,keepInvalidTags:!1,mixTagsAllowedAfter:/,|\.|\:|\s/,mixTagsInterpolator:["[[","]]"],backspace:!0,skipInvalid:!1,pasteAsTags:!0,editTags:{clicks:2,keepInvalid:!0},transformTag:function a(){},trim:!0,a11y:{focusableTags:!1},mixMode:{insertAfterTag:"\xA0"},autoComplete:{enabled:!0,rightKey:!1},classNames:{namespace:"tagify",mixMode:"tagify--mix",selectMode:"tagify--select",input:"tagify__input",focus:"tagify--focus",tagNoAnimation:"tagify--noAnim",tagInvalid:"tagify--invalid",tagNotAllowed:"tagify--notAllowed",scopeLoading:"tagify--loading",hasMaxTags:"tagify--hasMaxTags",hasNoTags:"tagify--noTags",empty:"tagify--empty",inputInvalid:"tagify__input--invalid",dropdown:"tagify__dropdown",dropdownWrapper:"tagify__dropdown__wrapper",dropdownItem:"tagify__dropdown__item",dropdownItemActive:"tagify__dropdown__item--active",dropdownInital:"tagify__dropdown--initial",tag:"tagify__tag",tagText:"tagify__tag-text",tagX:"tagify__tag__removeBtn",tagLoading:"tagify__tag--loading",tagEditing:"tagify__tag--editable",tagFlash:"tagify__tag--flash",tagHide:"tagify__tag--hide"},dropdown:{classname:"",enabled:2,maxItems:10,searchKeys:["value","searchBy"],fuzzySearch:!0,caseSensitive:!1,accentedSearch:!0,highlightFirst:!1,closeOnSelect:!0,clearOnSelect:!0,position:"all",appendTarget:null},hooks:{beforeRemoveTag:function a(){return Promise.resolve()},beforePaste:function a(){return Promise.resolve()},suggestionClick:function a(){return Promise.resolve()}}},g={empty:"empty",exceed:"number of tags exceeded",pattern:"pattern mismatch",duplicate:"already exists",notAllowed:"not allowed"};return c.prototype={_dropdown:{refs:function a(){this.DOM.dropdown=this.parseTemplate("dropdown",[this.settings]),this.DOM.dropdown.content=this.DOM.dropdown.querySelector(this.settings.classNames.dropdownWrapperSelector)},show:function n(b){var c,f,g,h=this,j=this.settings,k="mix"==j.mode&&!j.enforceWhitelist,l=!j.whitelist||!j.whitelist.length,m="manual"==j.dropdown.position;if(b=void 0===b?this.state.inputText:b,(!l||k||j.templates.dropdownItemNoMatch)&&!1!==j.dropdown.enable&&!this.state.isLoading){if(clearTimeout(this.dropdownHide__bindEventsTimeout),this.suggestedListItems=this.dropdown.filterListItems(b),b&&!this.suggestedListItems.length&&(this.trigger("dropdown:noMatch",b),j.templates.dropdownItemNoMatch&&(g=j.templates.dropdownItemNoMatch.call(this,{value:b}))),!g){if(this.suggestedListItems.length)b&&k&&!this.state.editing.scope&&!d(this.suggestedListItems[0].value,b)&&this.suggestedListItems.unshift({value:b});else{if(!b||!k||this.state.editing.scope)return this.input.autocomplete.suggest.call(this),void this.dropdown.hide();this.suggestedListItems=[{value:b}]}f=""+(w(c=this.suggestedListItems[0])?c.value:c),j.autoComplete&&f&&0==f.indexOf(b)&&this.input.autocomplete.suggest.call(this,c)}this.dropdown.fill(g),j.dropdown.highlightFirst&&this.dropdown.highlightOption(this.DOM.dropdown.content.children[0]),this.state.dropdown.visible||setTimeout(this.dropdown.events.binding.bind(this)),this.state.dropdown.visible=b||!0,this.state.dropdown.query=b,this.setStateSelection(),m||setTimeout(function(){h.dropdown.position(),h.dropdown.render()}),setTimeout(function(){h.trigger("dropdown:show",h.DOM.dropdown)})}},hide:function a(b){var c=this,d=this.DOM,e=d.scope,f=d.dropdown,g="manual"==this.settings.dropdown.position&&!b;if(f&&document.body.contains(f)&&!g)return window.removeEventListener("resize",this.dropdown.position),this.dropdown.events.binding.call(this,!1),e.setAttribute("aria-expanded",!1),f.parentNode.removeChild(f),setTimeout(function(){c.state.dropdown.visible=!1},100),this.state.dropdown.query=this.state.ddItemData=this.state.ddItemElm=this.state.selection=null,this.state.tag&&this.state.tag.value.length&&(this.state.flaggedTags[this.state.tag.baseOffset]=this.state.tag),this.trigger("dropdown:hide",f),this},toggle:function b(a){this.dropdown[this.state.dropdown.visible&&!a?"hide":"show"]()},render:function a(){var b,c,d,f=this,g=(b=this.DOM.dropdown,(d=b.cloneNode(!0)).style.cssText="position:fixed; top:-9999px; opacity:0",document.body.appendChild(d),c=d.clientHeight,d.parentNode.removeChild(d),c),h=this.settings;return"number"==typeof h.dropdown.enabled&&0<=h.dropdown.enabled?(this.DOM.scope.setAttribute("aria-expanded",!0),document.body.contains(this.DOM.dropdown)||(this.DOM.dropdown.classList.add(h.classNames.dropdownInital),this.dropdown.position(g),h.dropdown.appendTarget.appendChild(this.DOM.dropdown),setTimeout(function(){return f.DOM.dropdown.classList.remove(h.classNames.dropdownInital)})),this):this},fill:function c(a){var b;a="string"==typeof a?a:this.dropdown.createListHTML(a||this.suggestedListItems),this.DOM.dropdown.content.innerHTML=(b=a)?b.replace(/\>[\r\n ]+\</g,"><").replace(/(<.*?>)|\s+/g,function(a,b){return b||" "}):""},refilter:function b(a){a=a||this.state.dropdown.query||"",this.suggestedListItems=this.dropdown.filterListItems(a),this.dropdown.fill(),this.suggestedListItems.length||this.dropdown.hide(),this.trigger("dropdown:updated",this.DOM.dropdown)},position:function c(b){var f=this.settings.dropdown;if("manual"!=f.position){var e,j,k,m,p,q,u=this.DOM.dropdown,l=f.placeAbove,v=document.documentElement.clientHeight,h=480<Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)?f.position:"all",g=this.DOM["input"==h?"input":"scope"];b=b||u.clientHeight,this.state.dropdown.visible&&("text"==h?(k=(e=this.getCaretGlobalPosition()).bottom,j=e.top,m=e.left,p="auto"):(q=function(a){for(var b=0,c=0;a;)b+=a.offsetLeft||0,c+=a.offsetTop||0,a=a.parentNode;return{left:b,top:c}}(this.settings.dropdown.appendTarget),j=(e=g.getBoundingClientRect()).top-q.top,k=e.bottom-1-q.top,m=e.left-q.left,p=e.width+"px"),j=Math.floor(j),k=Math.ceil(k),l=void 0===l?v-e.bottom<b:l,u.style.cssText="left:"+(m+window.pageXOffset)+"px; width:"+p+";"+(l?"top: "+(j+window.pageYOffset)+"px":"top: "+(k+window.pageYOffset)+"px"),u.setAttribute("placement",l?"top":"bottom"),u.setAttribute("position",h))}},events:{binding:function e(){var a=!(0<arguments.length&&arguments[0]!==void 0)||arguments[0],b=this.dropdown.events.callbacks,c=this.listeners.dropdown=this.listeners.dropdown||{position:this.dropdown.position.bind(this),onKeyDown:b.onKeyDown.bind(this),onMouseOver:b.onMouseOver.bind(this),onMouseLeave:b.onMouseLeave.bind(this),onClick:b.onClick.bind(this),onScroll:b.onScroll.bind(this)},d=a?"addEventListener":"removeEventListener";"manual"!=this.settings.dropdown.position&&(window[d]("resize",c.position),window[d]("keydown",c.onKeyDown)),this.DOM.dropdown[d]("mouseover",c.onMouseOver),this.DOM.dropdown[d]("mouseleave",c.onMouseLeave),this.DOM.dropdown[d]("mousedown",c.onClick),this.DOM.dropdown.content[d]("scroll",c.onScroll)},callbacks:{onKeyDown:function a(b){var c=this,d=this.DOM.dropdown.querySelector(this.settings.classNames.dropdownItemActiveSelector),f=this.dropdown.getSuggestionDataByNode(d);switch(b.key){case"ArrowDown":case"ArrowUp":case"Down":case"Up":var g;b.preventDefault(),d&&(d=d[("ArrowUp"==b.key||"Up"==b.key?"previous":"next")+"ElementSibling"]),d||(g=this.DOM.dropdown.content.children,d=g["ArrowUp"==b.key||"Up"==b.key?g.length-1:0]),f=this.dropdown.getSuggestionDataByNode(d),this.dropdown.highlightOption(d,!0);break;case"Escape":case"Esc":this.dropdown.hide();break;case"ArrowRight":if(this.state.actions.ArrowLeft)return;case"Tab":if("mix"!=this.settings.mode&&d&&!this.settings.autoComplete.rightKey&&!this.state.editing){b.preventDefault();var h=this.dropdown.getMappedValue(f);return this.input.autocomplete.set.call(this,h),!1}return!0;case"Enter":b.preventDefault(),this.settings.hooks.suggestionClick(b,{tagify:this,tagData:f,suggestionElm:d}).then(function(){return d?c.dropdown.selectOption(d):void(c.dropdown.hide(),"mix"!=c.settings.mode&&c.addTags(c.state.inputText.trim(),!0))}).catch(function(a){return a});break;case"Backspace":{if("mix"==this.settings.mode||this.state.editing.scope)return;var j=this.input.raw.call(this);""!=j&&8203!=j.charCodeAt(0)||(!0===this.settings.backspace?this.removeTags():"edit"==this.settings.backspace&&setTimeout(this.editTag.bind(this),0))}}},onMouseOver:function c(a){var b=a.target.closest(this.settings.classNames.dropdownItemSelector);b&&this.dropdown.highlightOption(b)},onMouseLeave:function a(){this.dropdown.highlightOption()},onClick:function e(a){var b=this;if(0==a.button&&a.target!=this.DOM.dropdown&&a.target!=this.DOM.dropdown.content){var c=a.target.closest(this.settings.classNames.dropdownItemSelector),d=this.dropdown.getSuggestionDataByNode(c);this.state.actions.selectOption=!0,setTimeout(function(){return b.state.actions.selectOption=!1},50),this.settings.hooks.suggestionClick(a,{tagify:this,tagData:d,suggestionElm:c}).then(function(){c?b.dropdown.selectOption(c):b.dropdown.hide()}).catch(function(a){return console.warn(a)})}},onScroll:function d(a){var b=a.target,c=100*(b.scrollTop/(b.scrollHeight-b.parentNode.clientHeight));this.trigger("dropdown:scroll",{percentage:Math.round(c)})}}},getSuggestionDataByNode:function c(a){var b=a?+a.getAttribute("tagifySuggestionIdx"):-1;return this.suggestedListItems[b]||null},highlightOption:function e(a,b){var c,d=this.settings.classNames.dropdownItemActive;return(this.state.ddItemElm&&(this.state.ddItemElm.classList.remove(d),this.state.ddItemElm.removeAttribute("aria-selected")),!a)?(this.state.ddItemData=null,this.state.ddItemElm=null,void this.input.autocomplete.suggest.call(this)):void(c=this.suggestedListItems[this.getNodeIndex(a)],this.state.ddItemData=c,this.state.ddItemElm=a,a.classList.add(d),a.setAttribute("aria-selected",!0),b&&(a.parentNode.scrollTop=a.clientHeight+a.offsetTop-a.parentNode.clientHeight),this.settings.autoComplete&&(this.input.autocomplete.suggest.call(this,c),this.dropdown.position()))},selectOption:function j(b){var c,d=this,f=this.settings.dropdown,g=f.clearOnSelect,h=f.closeOnSelect;if(!b)return c=this.addTags(this.state.inputText,!0),void(h&&this.dropdown.hide());var a=b.getAttribute("tagifySuggestionIdx"),i=this.suggestedListItems[+a];this.trigger("dropdown:select",{data:i,elm:b}),a&&i?(this.state.editing?this.onEditTagDone(null,v({__isValid:!0},this.normalizeTags(i)[0])):c=this["mix"==this.settings.mode?"addMixTags":"addTags"]([i],g),this.DOM.input.parentNode&&(setTimeout(function(){d.DOM.input.focus(),d.toggleFocusClass(!0),d.placeCaretAfterNode(c)}),h?setTimeout(this.dropdown.hide.bind(this)):this.dropdown.refilter())):this.dropdown.hide()},selectAll:function a(){return this.suggestedListItems.length=0,this.dropdown.hide(),this.addTags(this.dropdown.filterListItems(""),!0),this},filterListItems:function B(b,h){function j(a,b){return b.toLowerCase().split(" ").every(function(b){return a.includes(b.toLowerCase())})}var f,k,q,x,y,z=this,A=this.settings,r=A.dropdown,d=(h=h||{},b="select"==A.mode&&this.value.length&&this.value[0][A.tagTextProp]==b?"":b,[]),g=[],c=A.whitelist,p=r.maxItems||1/0,u=r.searchKeys,m=0;if(!b||!u.length)return(A.duplicates?c:c.filter(function(a){return!z.isTagDuplicate(w(a)?a.value:a)})).slice(0,p);for(y=r.caseSensitive?""+b:(""+b).toLowerCase();m<c.length;m++){var C=void 0,D=void 0;f=c[m]instanceof Object?c[m]:{value:c[m]};var E=Object.keys(f).some(function(a){return u.includes(a)})?u:["value"];r.fuzzySearch&&!h.exact?(q=E.reduce(function(a,b){return a+" "+(f[b]||"")},"").toLowerCase().trim(),r.accentedSearch&&(q=l(q),y=l(y)),C=0==q.indexOf(y),D=q===y,k=j(q,y)):(C=!0,k=E.some(function(a){var b=""+(f[a]||"");return r.accentedSearch&&(b=l(b),y=l(y)),r.caseSensitive||(b=b.toLowerCase()),D=b===y,h.exact?b===y:0==b.indexOf(y)})),x=!A.duplicates&&this.isTagDuplicate(w(f)?f.value:f),k&&!x&&(D&&C?g.push(f):"startsWith"==r.sortby&&C?d.unshift(f):d.push(f))}return"function"==typeof r.sortby?r.sortby(g.concat(d),y):g.concat(d).slice(0,p)},getMappedValue:function c(a){var b=this.settings.dropdown.mapValueTo;return b?"function"==typeof b?b(a):a[b]||a.value:a.value},createListHTML:function c(a){var b=this;return v([],a).map(function(a,c){"string"!=typeof a&&"number"!=typeof a||(a={value:a});var d=b.dropdown.getMappedValue(a);a.value=d&&"string"==typeof d?n(d):d;var e=b.settings.templates.dropdownItem.apply(b,[a,b]);return e=e.replace(/\s*tagifySuggestionIdx=(["'])(.*?)\1/gim,"").replace(">"," tagifySuggestionIdx=\""+c+"\">")}).join("")}},customEventsList:["change","add","remove","invalid","input","click","keydown","focus","blur","edit:input","edit:beforeUpdate","edit:updated","edit:start","edit:keydown","dropdown:show","dropdown:hide","dropdown:select","dropdown:updated","dropdown:noMatch","dropdown:scroll"],dataProps:["__isValid","__removed","__originalData","__originalHTML","__tagId"],trim:function b(a){return this.settings.trim&&a&&"string"==typeof a?a.trim():a},parseHTML:function b(a){return new DOMParser().parseFromString(a.trim(),"text/html").body.firstElementChild},templates:{wrapper:function c(a,b){return"<tags class=\""+b.classNames.namespace+" "+(b.mode?""+b.classNames[b.mode+"Mode"]:"")+" "+a.className+"\"\n                    "+(b.readonly?"readonly":"")+"\n                    "+(b.disabled?"disabled":"")+"\n                    "+(b.required?"required":"")+"\n                    tabIndex=\"-1\">\n            <span "+(!b.readonly&&b.userInput?"contenteditable":"")+" tabIndex=\"0\" data-placeholder=\""+(b.placeholder||"&#8203;")+"\" aria-placeholder=\""+(b.placeholder||"")+"\"\n                class=\""+b.classNames.input+"\"\n                role=\"textbox\"\n                aria-autocomplete=\"both\"\n                aria-multiline=\""+("mix"==b.mode)+"\"></span>\n                &#8203;\n        </tags>"},tag:function c(a){var b=this.settings;return"<tag title=\""+(a.title||a.value)+"\"\n                    contenteditable='false'\n                    spellcheck='false'\n                    tabIndex=\""+(b.a11y.focusableTags?0:-1)+"\"\n                    class=\""+b.classNames.tag+" "+(a.class||"")+"\"\n                    "+this.getAttributes(a)+">\n            <x title='' class=\""+b.classNames.tagX+"\" role='button' aria-label='remove tag'></x>\n            <div>\n                <span class=\""+b.classNames.tagText+"\">"+(a[b.tagTextProp]||a.value)+"</span>\n            </div>\n        </tag>"},dropdown:function e(a){var b=a.dropdown,c="manual"==b.position,d=""+a.classNames.dropdown;return"<div class=\""+(c?"":d)+" "+b.classname+"\" role=\"listbox\" aria-labelledby=\"dropdown\">\n                    <div class=\""+a.classNames.dropdownWrapper+"\"></div>\n                </div>"},dropdownItem:function b(a){return"<div "+this.getAttributes(a)+"\n                    class='"+this.settings.classNames.dropdownItem+" "+(a.class?a.class:"")+"'\n                    tabindex=\"0\"\n                    role=\"option\">"+a.value+"</div>"},dropdownItemNoMatch:null},parseTemplate:function c(a,b){return a=this.settings.templates[a]||a,this.parseHTML(a.apply(this,b))},set whitelist(a){var b=a&&Array.isArray(a);this.settings.whitelist=b?a:[],this.setPersistedData(b?a:[],"whitelist")},get whitelist(){return this.settings.whitelist},applySettings:function a(b,c){e.templates=this.templates;var d=this.settings=v({},e,c);d.disabled=b.hasAttribute("disabled"),d.readonly=d.readonly||b.hasAttribute("readonly"),d.placeholder=b.getAttribute("placeholder")||d.placeholder||"",d.required=b.hasAttribute("required");var f=function(a){Object.defineProperty(d.classNames,a+"Selector",{get:function b(){return"."+this[a].split(" ")[0]}})};for(var a in d.classNames)f(a);if(this.isIE&&(d.autoComplete=!1),["whitelist","blacklist"].forEach(function(a){var c=b.getAttribute("data-"+a);c&&(c=c.split(d.delimiters))instanceof Array&&(d[a]=c)}),"autoComplete"in c&&!w(c.autoComplete)&&(d.autoComplete=e.autoComplete,d.autoComplete.enabled=c.autoComplete),"mix"==d.mode&&(d.autoComplete.rightKey=!0,d.delimiters=c.delimiters||null,d.tagTextProp&&!d.dropdown.searchKeys.includes(d.tagTextProp)&&d.dropdown.searchKeys.push(d.tagTextProp)),b.pattern)try{d.pattern=new RegExp(b.pattern)}catch(a){}if(this.settings.delimiters)try{d.delimiters=new RegExp(this.settings.delimiters,"g")}catch(a){}d.disabled&&(d.userInput=!1),this.TEXTS=j(j({},g),d.texts||{}),"select"!=d.mode&&d.userInput||(d.dropdown.enabled=0),d.dropdown.appendTarget=c.dropdown&&c.dropdown.appendTarget?c.dropdown.appendTarget:document.body;var h=this.getPersistedData("whitelist");Array.isArray(h)&&(this.whitelist=Array.isArray(d.whitelist)?function(){var a=[],b={},c=!0,d=!1,e=void 0;try{for(var f,g=arguments[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=f.value,i=!0,j=!1,k=void 0;try{for(var l,m,n=h[Symbol.iterator]();!(i=(l=n.next()).done);i=!0)m=l.value,w(m)?b[m.value]||(a.push(m),b[m.value]=1):a.includes(m)||a.push(m)}catch(a){j=!0,k=a}finally{try{!i&&n.return&&n.return()}finally{if(j)throw k}}}}catch(a){d=!0,e=a}finally{try{!c&&g.return&&g.return()}finally{if(d)throw e}}return a}(d.whitelist,h):h)},getAttributes:function f(a){var b,c=this.getCustomAttributes(a),d="";for(b in c)d+=" "+b+(void 0===a[b]?"":"=\""+c[b]+"\"");return d},getCustomAttributes:function d(a){if(!w(a))return"";var b,c={};for(b in a)"__"!=b.slice(0,2)&&"class"!=b&&a.hasOwnProperty(b)&&void 0!==a[b]&&(c[b]=n(a[b]));return c},setStateSelection:function c(){var a=window.getSelection(),b={anchorOffset:a.anchorOffset,anchorNode:a.anchorNode,range:a.getRangeAt&&a.rangeCount&&a.getRangeAt(0)};return this.state.selection=b,b},getCaretGlobalPosition:function g(){var a=document.getSelection();if(a.rangeCount){var b=a.getRangeAt(0),c=b.startContainer,d=b.startOffset,e=void 0,f=void 0;if(0<d)return f=document.createRange(),f.setStart(c,d-1),f.setEnd(c,d),e=f.getBoundingClientRect(),{left:e.right,top:e.top,bottom:e.bottom};if(c.getBoundingClientRect)return c.getBoundingClientRect()}return{left:-9999,top:-9999}},getCSSVars:function c(){var a,b=getComputedStyle(this.DOM.scope,null);this.CSSVars={tagHideTransition:function(a){var b=a.value,c=a.unit;return"s"==c?1e3*b:b}(function(a){if(!a)return{};var b=(a=a.trim().split(" ")[0]).split(/\d+/g).filter(function(a){return a}).pop().trim();return{value:+a.split(b).filter(function(a){return a})[0].trim(),unit:b}}((a="tag-hide-transition",b.getPropertyValue("--"+a))))}},build:function c(a){var b=this.DOM;this.settings.mixMode.integrated?(b.originalInput=null,b.scope=a,b.input=a):(b.originalInput=a,b.scope=this.parseTemplate("wrapper",[a,this.settings]),b.input=b.scope.querySelector(this.settings.classNames.inputSelector),a.parentNode.insertBefore(b.scope,a))},destroy:function a(){this.events.unbindGlobal.call(this),this.DOM.scope.parentNode.removeChild(this.DOM.scope),this.dropdown.hide(!0),clearTimeout(this.dropdownHide__bindEventsTimeout)},loadOriginalValues:function d(a){var b,c=this.settings;if(this.state.blockChangeEvent=!0,void 0===a){var f=this.getPersistedData("value");a=f&&!this.DOM.originalInput.value?f:c.mixMode.integrated?this.DOM.input.textContent:this.DOM.originalInput.value}if(this.removeAllTags(),!a)this.postUpdate();else if("mix"==c.mode)this.parseMixTags(this.trim(a)),(b=this.DOM.input.lastChild)&&"BR"==b.tagName||this.DOM.input.insertAdjacentHTML("beforeend","<br>");else{try{JSON.parse(a)instanceof Array&&(a=JSON.parse(a))}catch(a){}this.addTags(a).forEach(function(a){return a&&a.classList.add(c.classNames.tagNoAnimation)})}this.state.lastOriginalValueReported=c.mixMode.integrated?"":this.DOM.originalInput.value,this.state.blockChangeEvent=!1},cloneEvent:function d(a){var b={};for(var c in a)b[c]=a[c];return b},loading:function b(a){return this.state.isLoading=a,this.DOM.scope.classList[a?"add":"remove"](this.settings.classNames.scopeLoading),this},tagLoading:function c(a,b){return a&&a.classList[b?"add":"remove"](this.settings.classNames.tagLoading),this},toggleClass:function c(a,b){"string"==typeof a&&this.DOM.scope.classList.toggle(a,b)},toggleFocusClass:function b(a){this.toggleClass(this.settings.classNames.focus,!!a)},triggerChangeEvent:function d(){if(!this.settings.mixMode.integrated){var a=this.DOM.originalInput,b=this.state.lastOriginalValueReported!==a.value,c=new CustomEvent("change",{bubbles:!0});b&&(this.state.lastOriginalValueReported=a.value,c.simulated=!0,a._valueTracker&&a._valueTracker.setValue(Math.random()),a.dispatchEvent(c),this.trigger("change",this.state.lastOriginalValueReported),a.value=this.state.lastOriginalValueReported)}},events:{customBinding:function b(){var a=this;this.customEventsList.forEach(function(b){a.on(b,a.settings.callbacks[b])})},binding:function h(){var b,c=!(0<arguments.length&&arguments[0]!==void 0)||arguments[0],d=this.events.callbacks,f=c?"addEventListener":"removeEventListener";if(!this.state.mainEvents||!c){for(var g in this.state.mainEvents=c,c&&!this.listeners.main&&(this.events.bindGlobal.call(this),this.settings.isJQueryPlugin&&jQuery(this.DOM.originalInput).on("tagify.removeAllTags",this.removeAllTags.bind(this))),b=this.listeners.main=this.listeners.main||{focus:["input",d.onFocusBlur.bind(this)],keydown:["input",d.onKeydown.bind(this)],click:["scope",d.onClickScope.bind(this)],dblclick:["scope",d.onDoubleClickScope.bind(this)],paste:["input",d.onPaste.bind(this)],drop:["input",d.onDrop.bind(this)]})this.DOM[b[g][0]][f](g,b[g][1]);clearInterval(this.listeners.main.originalInputValueObserverInterval),this.listeners.main.originalInputValueObserverInterval=setInterval(d.observeOriginalInputValue.bind(this),500);var a=this.listeners.main.inputMutationObserver||new MutationObserver(d.onInputDOMChange.bind(this));a&&a.disconnect(),"mix"==this.settings.mode&&a.observe(this.DOM.input,{childList:!0})}},bindGlobal:function k(a){var b,c=this.events.callbacks,d=a?"removeEventListener":"addEventListener";if(a||!this.listeners.global){var f=!0,g=!1,h=void 0;try{for(var i,j=(this.listeners.global=this.listeners&&this.listeners.global||[{type:this.isIE?"keydown":"input",target:this.DOM.input,cb:c[this.isIE?"onInputIE":"onInput"].bind(this)},{type:"keydown",target:window,cb:c.onWindowKeyDown.bind(this)},{type:"blur",target:this.DOM.input,cb:c.onFocusBlur.bind(this)}],this.listeners.global)[Symbol.iterator]();!(f=(i=j.next()).done);f=!0)b=i.value,b.target[d](b.type,b.cb)}catch(a){g=!0,h=a}finally{try{!f&&j.return&&j.return()}finally{if(g)throw h}}}},unbindGlobal:function a(){this.events.bindGlobal.call(this,!0)},callbacks:{onFocusBlur:function l(b){var c=b.target?this.trim(b.target.textContent):"",d=this.settings,f=b.type,g=0<=d.dropdown.enabled,a={relatedTarget:b.relatedTarget},i=this.state.actions.selectOption&&(g||!d.dropdown.closeOnSelect),j=this.state.actions.addNew&&g,k=b.relatedTarget&&h.call(this,b.relatedTarget)&&this.DOM.scope.contains(b.relatedTarget);if("blur"==f){if(b.relatedTarget===this.DOM.scope)return this.dropdown.hide(),void this.DOM.input.focus();this.postUpdate(),this.triggerChangeEvent()}if(!i&&!j)if(this.state.hasFocus="focus"==f&&+new Date,this.toggleFocusClass(this.state.hasFocus),"mix"!=d.mode){if("focus"==f)return this.trigger("focus",a),void(0!==d.dropdown.enabled&&d.userInput||this.dropdown.show(this.value.length?"":void 0));"blur"==f&&(this.trigger("blur",a),this.loading(!1),"select"==this.settings.mode&&k&&(c=""),("select"==this.settings.mode&&c?!this.value.length||this.value[0].value!=c:c&&!this.state.actions.selectOption&&d.addTagOnBlur)&&this.addTags(c,!0),"select"!=this.settings.mode||c||this.removeTags()),this.DOM.input.removeAttribute("style"),this.dropdown.hide()}else"focus"==f?this.trigger("focus",a):"blur"==b.type&&(this.trigger("blur",a),this.loading(!1),this.dropdown.hide(),this.state.dropdown.visible=void 0,this.setStateSelection())},onWindowKeyDown:function d(a){var b,c=document.activeElement;if(h.call(this,c)&&this.DOM.scope.contains(document.activeElement))switch(b=c.nextElementSibling,a.key){case"Backspace":this.removeTags(c),(b||this.DOM.input).focus();break;case"Enter":setTimeout(this.editTag.bind(this),0,c);}},onKeydown:function m(b){var c=this,f=this.settings;"select"==f.mode&&f.enforceWhitelist&&this.value.length&&"Tab"!=b.key&&b.preventDefault();var e=this.trim(b.target.textContent);if(this.trigger("keydown",{originalEvent:this.cloneEvent(b)}),"mix"==f.mode){switch(b.key){case"Left":case"ArrowLeft":this.state.actions.ArrowLeft=!0;break;case"Delete":case"Backspace":if(this.state.editing)return;var g,j,k,n=document.getSelection(),l="Delete"==b.key&&n.anchorOffset==(n.anchorNode.length||0),d=n.anchorNode.previousSibling,t=1==n.anchorNode.nodeType||!n.anchorOffset&&d&&1==d.nodeType&&n.anchorNode.previousSibling,p=q(this.DOM.input.innerHTML),u=this.getTagElms();if("edit"==f.backspace&&t)return g=1==n.anchorNode.nodeType?null:n.anchorNode.previousElementSibling,setTimeout(this.editTag.bind(this),0,g),void b.preventDefault();if(x()&&t)return k=i(t),t.hasAttribute("readonly")||t.remove(),this.DOM.input.focus(),void setTimeout(function(){c.placeCaretAfterNode(k),c.DOM.input.click()});if("BR"==n.anchorNode.nodeName)return;if((l||t)&&1==n.anchorNode.nodeType?j=0==n.anchorOffset?l?u[0]:null:u[n.anchorOffset-1]:l?j=n.anchorNode.nextElementSibling:t&&(j=t),3==n.anchorNode.nodeType&&!n.anchorNode.nodeValue&&n.anchorNode.previousElementSibling&&b.preventDefault(),(t||l)&&!f.backspace)return void b.preventDefault();if("Range"!=n.type&&!n.anchorOffset&&n.anchorNode==this.DOM.input&&"Delete"!=b.key)return void b.preventDefault();if("Range"!=n.type&&j&&j.hasAttribute("readonly"))return void this.placeCaretAfterNode(i(j));clearTimeout(o),o=setTimeout(function(){var a=document.getSelection(),b=q(c.DOM.input.innerHTML),d=!l&&a.anchorNode.previousSibling;if(b.length>=p.length&&d)if(!(h.call(c,d)&&!d.hasAttribute("readonly")))d.remove();else if(c.removeTags(d),c.fixFirefoxLastTagNoCaret(),2==c.DOM.input.children.length&&"BR"==c.DOM.input.children[1].tagName)return c.DOM.input.innerHTML="",c.value.length=0,!0;c.value=[].map.call(u,function(a,b){var d=c.tagData(a);return a.parentNode||d.readonly?d:void c.trigger("remove",{tag:a,index:b,data:d})}).filter(function(a){return a})},20);}return!0}switch(b.key){case"Backspace":"select"==f.mode&&f.enforceWhitelist&&this.value.length?this.removeTags():this.state.dropdown.visible&&"manual"!=f.dropdown.position||""!=b.target.textContent&&8203!=e.charCodeAt(0)||(!0===f.backspace?this.removeTags():"edit"==f.backspace&&setTimeout(this.editTag.bind(this),0));break;case"Esc":case"Escape":if(this.state.dropdown.visible)return;b.target.blur();break;case"Down":case"ArrowDown":this.state.dropdown.visible||this.dropdown.show();break;case"ArrowRight":{var v=this.state.inputSuggestion||this.state.ddItemData;if(v&&f.autoComplete.rightKey)return void this.addTags([v],!0);break}case"Tab":{var w="select"==f.mode;if(!e||w)return!0;b.preventDefault()}case"Enter":if(this.state.dropdown.visible||229==b.keyCode)return;b.preventDefault(),setTimeout(function(){c.state.actions.selectOption||c.addTags(e,!0)});}},onInput:function e(a){if(this.postUpdate(),"mix"==this.settings.mode)return this.events.callbacks.onMixTagsInput.call(this,a);var b=this.input.normalize.call(this),c=b.length>=this.settings.dropdown.enabled,d={value:b,inputElm:this.DOM.input};d.isValid=this.validateTag({value:b}),this.state.inputText!=b&&(this.input.set.call(this,b,!1),-1==b.search(this.settings.delimiters)?0<=this.settings.dropdown.enabled&&this.dropdown[c?"show":"hide"](b):this.addTags(b)&&this.input.set.call(this),this.trigger("input",d))},onMixTagsInput:function B(b){var d,f,g,j,k,q,t,w,y=this,z=this.settings,h=this.value.length,c=this.getTagElms(),p=document.createDocumentFragment(),u=window.getSelection().getRangeAt(0),A=[].map.call(c,function(a){return y.tagData(a).value});if("deleteContentBackward"==b.inputType&&x()&&this.events.callbacks.onKeydown.call(this,{target:b.target,key:"Backspace"}),this.value.slice().forEach(function(a){a.readonly&&!A.includes(a.value)&&p.appendChild(y.createTagElem(a))}),p.childNodes.length&&(u.insertNode(p),this.setRangeAtStartEnd(!1,p.lastChild)),c.length!=h)return this.value=[].map.call(this.getTagElms(),function(a){return y.tagData(a)}),void this.update({withoutChangeEvent:!0});if(this.hasMaxTags())return!0;if(window.getSelection&&0<(q=window.getSelection()).rangeCount&&3==q.anchorNode.nodeType){if((u=q.getRangeAt(0).cloneRange()).collapse(!0),u.setStart(q.focusNode,0),g=(d=u.toString().slice(0,u.endOffset)).split(z.pattern).length-1,(f=d.match(z.pattern))&&(j=d.slice(d.lastIndexOf(f[f.length-1]))),j){if(this.state.actions.ArrowLeft=!1,this.state.tag={prefix:j.match(z.pattern)[0],value:j.replace(z.pattern,"")},this.state.tag.baseOffset=q.baseOffset-this.state.tag.value.length,w=this.state.tag.value.match(z.delimiters))return this.state.tag.value=this.state.tag.value.replace(z.delimiters,""),this.state.tag.delimiters=w[0],this.addTags(this.state.tag.value,z.dropdown.clearOnSelect),void this.dropdown.hide();k=this.state.tag.value.length>=z.dropdown.enabled;try{t=(t=this.state.flaggedTags[this.state.tag.baseOffset]).prefix==this.state.tag.prefix&&t.value[0]==this.state.tag.value[0],this.state.flaggedTags[this.state.tag.baseOffset]&&!this.state.tag.value&&delete this.state.flaggedTags[this.state.tag.baseOffset]}catch(a){}(t||g<this.state.mixMode.matchedPatternCount)&&(k=!1)}else this.state.flaggedTags={};this.state.mixMode.matchedPatternCount=g}setTimeout(function(){y.update({withoutChangeEvent:!0}),y.trigger("input",v({},y.state.tag,{textContent:y.DOM.input.textContent})),y.state.tag&&y.dropdown[k?"show":"hide"](y.state.tag.value)},10)},onInputIE:function c(a){var b=this;setTimeout(function(){b.events.callbacks.onInput.call(b,a)})},observeOriginalInputValue:function a(){this.DOM.originalInput.value!=this.DOM.originalInput.tagifyValue&&this.loadOriginalValues()},onClickScope:function e(a){var b=this.settings,c=a.target.closest("."+b.classNames.tag),d=+new Date-this.state.hasFocus;if(a.target!=this.DOM.scope){if(!a.target.classList.contains(b.classNames.tagX))return c?(this.trigger("click",{tag:c,index:this.getNodeIndex(c),data:this.tagData(c),originalEvent:this.cloneEvent(a)}),void(1!==b.editTags&&1!==b.editTags.clicks||this.events.callbacks.onDoubleClickScope.call(this,a))):void(a.target==this.DOM.input&&("mix"==b.mode&&this.fixFirefoxLastTagNoCaret(),500<d)?this.state.dropdown.visible?this.dropdown.hide():0===b.dropdown.enabled&&"mix"!=b.mode&&this.dropdown.show(this.value.length?"":void 0):"select"==b.mode&&!this.state.dropdown.visible&&this.dropdown.show());this.removeTags(a.target.parentNode)}else this.state.hasFocus||this.DOM.input.focus()},onPaste:function g(a){var b=this;a.preventDefault();var c,d,f=this.settings;return("select"!=f.mode||!f.enforceWhitelist)&&f.userInput&&void(f.readonly||(c=a.clipboardData||window.clipboardData,d=c.getData("Text"),f.hooks.beforePaste(a,{tagify:this,pastedText:d,clipboardData:c}).then(function(c){void 0===c&&(c=d),c&&(b.injectAtCaret(c,window.getSelection().getRangeAt(0)),"mix"==b.settings.mode?b.events.callbacks.onMixTagsInput.call(b,a):b.settings.pasteAsTags?b.addTags(b.state.inputText+c,!0):b.state.inputText=c)}).catch(function(a){return a})))},onDrop:function b(a){a.preventDefault()},onEditTagInput:function i(b,c){var d=b.closest("."+this.settings.classNames.tag),e=this.getNodeIndex(d),f=this.tagData(d),a=this.input.normalize.call(this,b),g=d.innerHTML!=d.__tagifyTagData.__originalHTML,h=this.validateTag(_defineProperty({},this.settings.tagTextProp,a));g||!0!==b.originalIsValid||(h=!0),d.classList.toggle(this.settings.classNames.tagInvalid,!0!==h),f.__isValid=h,d.title=!0===h?f.title||f.value:h,a.length>=this.settings.dropdown.enabled&&(this.state.editing&&(this.state.editing.value=a),this.dropdown.show(a)),this.trigger("edit:input",{tag:d,index:e,data:v({},this.value[e],{newValue:a}),originalEvent:this.cloneEvent(c)})},onEditTagFocus:function b(a){this.state.editing={scope:a,input:a.querySelector("[contenteditable]")}},onEditTagBlur:function n(b){if(this.state.hasFocus||this.toggleFocusClass(),this.DOM.scope.contains(b)){var c,d,f=this.settings,g=b.closest("."+f.classNames.tag),a=this.input.normalize.call(this,b),h=this.tagData(g).__originalData,j=g.innerHTML!=g.__tagifyTagData.__originalHTML,k=this.validateTag(_defineProperty({},f.tagTextProp,a));if(!a)this.onEditTagDone(g);else if(j){var m;if(c=this.hasMaxTags(),d=this.getWhitelistItem(a)||v({},h,(m={},_defineProperty(m,f.tagTextProp,a),_defineProperty(m,"value",a),_defineProperty(m,"__isValid",k),m)),f.transformTag.call(this,d,h),!0!==(k=(!c||!0===h.__isValid)&&this.validateTag(_defineProperty({},f.tagTextProp,d[f.tagTextProp])))){if(this.trigger("invalid",{data:d,tag:g,message:k}),f.editTags.keepInvalid)return;f.keepInvalidTags?d.__isValid=k:d=h}else f.keepInvalidTags&&(delete d.title,delete d["aria-invalid"],delete d.class);this.onEditTagDone(g,d)}else this.onEditTagDone(g,h)}},onEditTagkeydown:function c(a,b){switch(this.trigger("edit:keydown",{originalEvent:this.cloneEvent(a)}),a.key){case"Esc":case"Escape":b.innerHTML=b.__tagifyTagData.__originalHTML;case"Enter":case"Tab":a.preventDefault(),a.target.blur();}},onDoubleClickScope:function a(b){var c,d,f=b.target.closest("."+this.settings.classNames.tag),g=this.settings;f&&g.userInput&&(c=f.classList.contains(this.settings.classNames.tagEditing),d=f.hasAttribute("readonly"),"select"==g.mode||g.readonly||c||d||!this.settings.editTags||this.editTag(f),this.toggleFocusClass(!0),this.trigger("dblclick",{tag:f,index:this.getNodeIndex(f),data:this.tagData(f)}))},onInputDOMChange:function d(a){var b=this;a.forEach(function(a){a.addedNodes.forEach(function(a){if(a)if("<div><br></div>"==a.outerHTML)a.replaceWith(document.createElement("br"));else if(1==a.nodeType&&a.querySelector(b.settings.classNames.tagSelector)){var c=document.createTextNode("");3==a.childNodes[0].nodeType&&"BR"!=a.previousSibling.nodeName&&(c=document.createTextNode("\n")),a.replaceWith.apply(a,[c].concat(_toConsumableArray([].concat(_toConsumableArray(a.childNodes)).slice(0,-1)))),b.placeCaretAfterNode(c.previousSibling)}else h.call(b,a)&&a.previousSibling&&"BR"==a.previousSibling.nodeName&&(a.previousSibling.replaceWith("\n\u200B"),b.placeCaretAfterNode(a.previousSibling.previousSibling))}),a.removedNodes.forEach(function(a){a&&"BR"==a.nodeName&&h.call(b,c)&&(b.removeTags(c),b.fixFirefoxLastTagNoCaret())})});var c=this.DOM.input.lastChild;c&&""==c.nodeValue&&c.remove(),c&&"BR"==c.nodeName||this.DOM.input.appendChild(document.createElement("br"))}}},fixFirefoxLastTagNoCaret:function a(){},placeCaretAfterNode:function e(a){if(a&&a.parentNode){var b=a.nextSibling,c=window.getSelection(),d=c.getRangeAt(0);c.rangeCount&&(d.setStartAfter(b||a),d.collapse(!0),c.removeAllRanges(),c.addRange(d))}},insertAfterTag:function c(a,b){if(b=b||this.settings.mixMode.insertAfterTag,a&&a.parentNode&&b)return b="string"==typeof b?document.createTextNode(b):b,a.parentNode.insertBefore(b,a.nextSibling),b},editTag:function n(b,c){var f=this;function d(){return b.querySelector(g.classNames.tagTextSelector)}b=b||this.getLastTag(),c=c||{},this.dropdown.hide();var g=this.settings,i=d(),a=this.getNodeIndex(b),j=this.tagData(b),k=this.events.callbacks,m=this,l=!0;if(!i)console.warn("Cannot find element in Tag template: .",g.classNames.tagTextSelector);else if(!(j instanceof Object&&"editable"in j)||j.editable)return i.setAttribute("contenteditable",!0),b.classList.add(g.classNames.tagEditing),this.tagData(b,{__originalData:v({},j),__originalHTML:b.innerHTML}),i.addEventListener("focus",k.onEditTagFocus.bind(this,b)),i.addEventListener("blur",function(){setTimeout(function(){return k.onEditTagBlur.call(m,d())})}),i.addEventListener("input",k.onEditTagInput.bind(this,i)),i.addEventListener("keydown",function(a){return k.onEditTagkeydown.call(f,a,b)}),i.focus(),this.setRangeAtStartEnd(!1,i),c.skipValidation||(l=this.editTagToggleValidity(b)),i.originalIsValid=l,this.trigger("edit:start",{tag:b,index:a,data:j,isValid:l}),this},editTagToggleValidity:function d(a,b){var c;return(b=b||this.tagData(a))?((c=!("__isValid"in b)||!0===b.__isValid)||this.removeTagsFromValue(a),this.update(),a.classList.toggle(this.settings.classNames.tagNotAllowed,!c),b.__isValid):void console.warn("tag has no data: ",a,b)},onEditTagDone:function d(a,b){b=b||{};var c={tag:a=a||this.state.editing.scope,index:this.getNodeIndex(a),previousData:this.tagData(a),data:b};this.trigger("edit:beforeUpdate",c,{cloneData:!1}),this.state.editing=!1,delete b.__originalData,delete b.__originalHTML,a&&b[this.settings.tagTextProp]?(a=this.replaceTag(a,b),this.editTagToggleValidity(a,b),this.settings.a11y.focusableTags&&a.focus()):a&&this.removeTags(a),this.trigger("edit:updated",c),this.dropdown.hide(),this.settings.keepInvalidTags&&this.reCheckInvalidTags()},replaceTag:function d(a,b){b&&b.value||(b=a.__tagifyTagData),b.__isValid&&1!=b.__isValid&&v(b,this.getInvalidTagAttrs(b,b.__isValid));var c=this.createTagElem(b);return a.parentNode.replaceChild(c,a),this.updateValueByDOMTags(),c},updateValueByDOMTags:function b(){var a=this;this.value.length=0,[].forEach.call(this.getTagElms(),function(b){b.classList.contains(a.settings.classNames.tagNotAllowed.split(" ")[0])||a.value.push(a.tagData(b))}),this.update()},setRangeAtStartEnd:function d(a,b){a="number"==typeof a?a:!!a,b=(b=b||this.DOM.input).lastChild||b;var c=document.getSelection();try{1<=c.rangeCount&&["Start","End"].forEach(function(d){return c.getRangeAt(0)["set"+d](b,a||b.length)})}catch(a){}},injectAtCaret:function c(a,b){if(b=b||this.state.selection.range)return"string"==typeof a&&(a=document.createTextNode(a)),b.deleteContents(),b.insertNode(a),this.setRangeAtStartEnd(!1,a),this.updateValueByDOMTags(),this.update(),this},input:{set:function d(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"",b=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],c=this.settings.dropdown.closeOnSelect;this.state.inputText=a,b&&(this.DOM.input.innerHTML=n(""+a)),!a&&c&&this.dropdown.hide.bind(this),this.input.autocomplete.suggest.call(this),this.input.validate.call(this)},raw:function a(){return this.DOM.input.textContent},validate:function b(){var a=!this.state.inputText||!0===this.validateTag({value:this.state.inputText});return this.DOM.input.classList.toggle(this.settings.classNames.inputInvalid,!a),a},normalize:function d(a){var b=a||this.DOM.input,c=[];b.childNodes.forEach(function(a){return 3==a.nodeType&&c.push(a.nodeValue)}),c=c.join("\n");try{c=c.replace(/(?:\r\n|\r|\n)/g,this.settings.delimiters.source.charAt(0))}catch(a){}return c=c.replace(/\s/g," "),this.settings.trim&&(c=c.replace(/^\s+/,"")),c},autocomplete:{suggest:function e(a){if(this.settings.autoComplete.enabled){"string"==typeof(a=a||{})&&(a={value:a});var b=a.value?""+a.value:"",c=b.substr(0,this.state.inputText.length).toLowerCase(),d=b.substring(this.state.inputText.length);b&&this.state.inputText&&c==this.state.inputText.toLowerCase()?(this.DOM.input.setAttribute("data-suggest",d),this.state.inputSuggestion=a):(this.DOM.input.removeAttribute("data-suggest"),delete this.state.inputSuggestion)}},set:function d(a){var b=this.DOM.input.getAttribute("data-suggest"),c=a||(b?this.state.inputText+b:null);return!!c&&("mix"==this.settings.mode?this.replaceTextWithNode(document.createTextNode(this.state.tag.prefix+c)):(this.input.set.call(this,c),this.setRangeAtStartEnd()),this.input.autocomplete.suggest.call(this),this.dropdown.hide(),!0)}}},getTagIdx:function b(a){return this.value.findIndex(function(b){return b.__tagId==(a||{}).__tagId})},getNodeIndex:function c(a){var b=0;if(a)for(;a=a.previousElementSibling;)b++;return b},getTagElms:function e(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];var d="."+[].concat(_toConsumableArray(this.settings.classNames.tag.split(" ")),_toConsumableArray(b)).join(".");return[].slice.call(this.DOM.scope.querySelectorAll(d))},getLastTag:function b(){var a=this.DOM.scope.querySelectorAll(this.settings.classNames.tagSelector+":not(."+this.settings.classNames.tagHide+"):not([readonly])");return a[a.length-1]},tagData:function d(a,b,c){return a?(b&&(a.__tagifyTagData=c?b:v({},a.__tagifyTagData||{},b)),a.__tagifyTagData):(console.warn("tag element doesn't exist",a,b),b)},isTagDuplicate:function a(b,c){var e=this,f=this.settings;return"select"!=f.mode&&this.value.reduce(function(g,a){return d(e.trim(""+b),a.value,c||f.dropdown.caseSensitive)?g+1:g},0)},getTagIndexByValue:function a(b){var c=this,f=[];return this.getTagElms().forEach(function(e,g){d(c.trim(e.textContent),b,c.settings.dropdown.caseSensitive)&&f.push(g)}),f},getTagElmByValue:function c(a){var b=this.getTagIndexByValue(a)[0];return this.getTagElms()[b]},flashTag:function c(a){var b=this;a&&(a.classList.add(this.settings.classNames.tagFlash),setTimeout(function(){a.classList.remove(b.settings.classNames.tagFlash)},100))},isTagBlacklisted:function b(a){return a=this.trim(a.toLowerCase()),this.settings.blacklist.filter(function(b){return(""+b).toLowerCase()==a}).length},isTagWhitelisted:function b(a){return!!this.getWhitelistItem(a)},getWhitelistItem:function j(b,c,f){c=c||"value";var g,h=this.settings;return(f=f||h.whitelist).some(function(a){var e="string"==typeof a?a:a[c]||a.value;if(d(e,b,h.dropdown.caseSensitive,h.trim))return g="string"==typeof a?{value:a}:a,!0}),g||"value"!=c||"value"==h.tagTextProp||(g=this.getWhitelistItem(b,h.tagTextProp,f)),g},validateTag:function e(a){var b=this.settings,c="value"in a?"value":b.tagTextProp,d=this.trim(a[c]+"");return(a[c]+"").trim()?b.pattern&&b.pattern instanceof RegExp&&!b.pattern.test(d)?this.TEXTS.pattern:!b.duplicates&&this.isTagDuplicate(d,this.state.editing)?this.TEXTS.duplicate:this.isTagBlacklisted(d)||b.enforceWhitelist&&!this.isTagWhitelisted(d)?this.TEXTS.notAllowed:!b.validate||b.validate(a):this.TEXTS.empty},getInvalidTagAttrs:function c(a,b){return{"aria-invalid":!0,class:((a.class||"")+" "+this.settings.classNames.tagNotAllowed).trim(),title:b}},hasMaxTags:function a(){return this.value.length>=this.settings.maxTags&&this.TEXTS.exceed},setReadonly:function d(a,b){var c=this.settings;document.activeElement.blur(),c[b||"readonly"]=a,this.DOM.scope[(a?"set":"remove")+"Attribute"](b||"readonly",!0),"mix"==c.mode&&this.setContentEditable(!a)},setContentEditable:function b(a){!this.settings.readonly&&this.settings.userInput&&(this.DOM.input.contentEditable=a)},setDisabled:function b(a){this.setReadonly(a,"disabled")},normalizeTags:function d(b){var c,f=this,g=this.settings,e=g.whitelist,h=g.delimiters,j=g.mode,a=g.tagTextProp;g.enforceWhitelist;var k=[],i=!!e&&e[0]instanceof Object,m=b instanceof Array,l=function(b){return(b+"").split(h).filter(function(a){return a}).map(function(b){var c;return c={},_defineProperty(c,a,f.trim(b)),_defineProperty(c,"value",f.trim(b)),c})};if("number"==typeof b&&(b=b.toString()),"string"==typeof b){if(!b.trim())return[];b=l(b)}else m&&(b=(c=[]).concat.apply(c,_toConsumableArray(b.map(function(a){return a.value?a:l(a)}))));return i&&(b.forEach(function(b){var c=k.map(function(a){return a.value}),d=f.dropdown.filterListItems.call(f,b[a],{exact:!0});f.settings.duplicates||(d=d.filter(function(a){return!c.includes(a.value)}));var e=1<d.length?f.getWhitelistItem(b[a],a,d):d[0];e&&e instanceof Object?k.push(e):"mix"!=j&&(null==b.value&&(b.value=b[a]),k.push(b))}),k.length&&(b=k)),b},parseMixTags:function c(b){var f=this,g=this.settings,j=g.mixTagsInterpolator,i=g.duplicates,k=g.transformTag,a=g.enforceWhitelist,m=g.maxTags,n=g.tagTextProp,o=[];return b=b.split(j[0]).map(function(b,l){var e,q,r,s=b.split(j[1]),c=s[0],p=o.length==m;try{if(c==+c)throw Error;q=JSON.parse(c)}catch(a){q=f.normalizeTags(c)[0]||{value:c}}if(!(k.call(f,q),p||!(1<s.length)||a&&!f.isTagWhitelisted(q.value)||!i&&f.isTagDuplicate(q.value)))q[e=q[n]?n:"value"]=f.trim(q[e]),r=f.createTagElem(q),o.push(q),r.classList.add(f.settings.classNames.tagNoAnimation),s[0]=r.outerHTML,f.value.push(q);else if(b)return l?j[0]+b:b;return s.join("")}).join(""),this.DOM.input.innerHTML=b,this.DOM.input.appendChild(document.createTextNode("")),this.DOM.input.normalize(),this.getTagElms().forEach(function(a,b){return f.tagData(a,o[b])}),this.update({withoutChangeEvent:!0}),b},replaceTextWithNode:function j(b,c){if(this.state.tag||c){c=c||this.state.tag.prefix+this.state.tag.value;var d,f,g=window.getSelection(),a=g.anchorNode,h=this.state.tag.delimiters?this.state.tag.delimiters.length:0;return a.splitText(g.anchorOffset-h),!(-1!=(d=a.nodeValue.lastIndexOf(c)))||(f=a.splitText(d),b&&a.parentNode.replaceChild(b,f),!0)}},selectTag:function e(a,b){var c=this.settings;if(!c.enforceWhitelist||this.isTagWhitelisted(b.value)){this.input.set.call(this,b[c.tagTextProp]||b.value,!0),this.state.actions.selectOption&&setTimeout(this.setRangeAtStartEnd.bind(this));var d=this.getLastTag();return d?this.replaceTag(d,b):this.appendTag(a),c.enforceWhitelist&&this.setContentEditable(!1),this.value[0]=b,this.update(),this.trigger("add",{tag:a,data:b}),[a]}},addEmptyTag:function d(a){var b=v({value:""},a||{}),c=this.createTagElem(b);this.tagData(c,b),this.appendTag(c),this.editTag(c,{skipValidation:!0})},addTags:function j(b,c,d){var f=this,g=[],h=this.settings,a=document.createDocumentFragment();return d=d||h.skipInvalid,b&&0!=b.length?(b=this.normalizeTags(b),"mix"==h.mode?this.addMixTags(b):("select"==h.mode&&(c=!1),this.DOM.input.removeAttribute("style"),b.forEach(function(b){var c,i={},j=Object.assign({},b,{value:b.value+""});if(b=Object.assign({},j),h.transformTag.call(f,b),b.__isValid=f.hasMaxTags()||f.validateTag(b),!0!==b.__isValid){if(d)return;v(i,f.getInvalidTagAttrs(b,b.__isValid),{__preInvalidData:j}),b.__isValid==f.TEXTS.duplicate&&f.flashTag(f.getTagElmByValue(b.value))}return("readonly"in b&&(b.readonly?i["aria-readonly"]=!0:delete b.readonly),c=f.createTagElem(b,i),g.push(c),"select"==h.mode)?f.selectTag(c,b):void(a.appendChild(c),b.__isValid&&!0===b.__isValid?(f.value.push(b),f.trigger("add",{tag:c,index:f.value.length-1,data:b})):(f.trigger("invalid",{data:b,index:f.value.length,tag:c,message:b.__isValid}),h.keepInvalidTags||setTimeout(function(){return f.removeTags(c,!0)},1e3)),f.dropdown.position())}),this.appendTag(a),this.update(),b.length&&c&&this.input.set.call(this),this.dropdown.refilter(),g)):("select"==h.mode&&this.removeAllTags(),g)},addMixTags:function f(a){var b=this;if((a=this.normalizeTags(a))[0].prefix||this.state.tag)return this.prefixedTextToTag(a[0]);"string"==typeof a&&(a=[{value:a}]);var c=!!this.state.selection,d=document.createDocumentFragment();return a.forEach(function(a){var c=b.createTagElem(a);d.appendChild(c),b.insertAfterTag(c)}),c?this.injectAtCaret(d):(this.DOM.input.focus(),(c=this.setStateSelection()).range.setStart(this.DOM.input,c.range.endOffset),c.range.setEnd(this.DOM.input,c.range.endOffset),this.DOM.input.appendChild(d),this.updateValueByDOMTags(),this.update()),d},prefixedTextToTag:function a(b){var c,d=this,f=this.settings,g=this.state.tag.delimiters;if(f.transformTag.call(this,b),b.prefix=b.prefix||this.state.tag?this.state.tag.prefix:(f.pattern.source||f.pattern)[0],c=this.createTagElem(b),this.replaceTextWithNode(c)||this.DOM.input.appendChild(c),setTimeout(function(){return c.classList.add(d.settings.classNames.tagNoAnimation)},300),this.value.push(b),this.update(),!g){var h=this.insertAfterTag(c)||c;this.placeCaretAfterNode(h)}return this.state.tag=null,this.trigger("add",v({},{tag:c},{data:b})),c},appendTag:function d(a){var b=this.DOM,c=b.scope.lastElementChild;c===b.input?b.scope.insertBefore(a,c):b.scope.appendChild(a)},createTagElem:function a(b,c){b.__tagId="10000000-1000-4000-8000-100000000000".replace(/[018]/g,function(a){return(a^crypto.getRandomValues(new Uint8Array(1))[0]&15>>a/4).toString(16)});var d,e=v({},b,j({value:n(b.value+"")},c));return function(a){for(var b,c=document.createNodeIterator(a,NodeFilter.SHOW_TEXT,null,!1);b=c.nextNode();)b.textContent.trim()||b.parentNode.removeChild(b)}(d=this.parseTemplate("tag",[e])),this.tagData(d,b),d},reCheckInvalidTags:function a(){var b=this,c=this.settings;this.getTagElms(c.classNames.tagNotAllowed).forEach(function(c){var d=b.tagData(c),e=b.hasMaxTags(),f=b.validateTag(d);return!0!==f||e?void(c.title=e||f):(d=d.__preInvalidData?d.__preInvalidData:{value:d.value},b.replaceTag(c,d))})},removeTags:function g(a,b,c){var d,f=this;if(a=a&&a instanceof HTMLElement?[a]:a instanceof Array?a:a?[a]:[this.getLastTag()],d=a.reduce(function(a,b){b&&"string"==typeof b&&(b=f.getTagElmByValue(b));var c=f.tagData(b);return b&&c&&!c.readonly&&a.push({node:b,idx:f.getTagIdx(c),data:f.tagData(b,{__removed:!0})}),a},[]),c="number"==typeof c?c:this.CSSVars.tagHideTransition,"select"==this.settings.mode&&(c=0,this.input.set.call(this)),1==d.length&&d[0].node.classList.contains(this.settings.classNames.tagNotAllowed)&&(b=!0),d.length)return this.settings.hooks.beforeRemoveTag(d,{tagify:this}).then(function(){function a(a){a.node.parentNode&&(a.node.parentNode.removeChild(a.node),b?this.settings.keepInvalidTags&&this.trigger("remove",{tag:a.node,index:a.idx}):(this.trigger("remove",{tag:a.node,index:a.idx,data:a.data}),this.dropdown.refilter(),this.dropdown.position(),this.DOM.input.normalize(),this.settings.keepInvalidTags&&this.reCheckInvalidTags()))}c&&10<c&&1==d.length?function(b){b.node.style.width=parseFloat(window.getComputedStyle(b.node).width)+"px",document.body.clientTop,b.node.classList.add(this.settings.classNames.tagHide),setTimeout(a.bind(this),c,b)}.call(f,d[0]):d.forEach(a.bind(f)),b||(f.removeTagsFromValue(d.map(function(a){return a.node})),f.update(),"select"==f.settings.mode&&f.setContentEditable(!0))}).catch(function(){})},removeTagsFromDOM:function a(){[].slice.call(this.getTagElms()).forEach(function(a){return a.parentNode.removeChild(a)})},removeTagsFromValue:function c(a){var b=this;(a=Array.isArray(a)?a:[a]).forEach(function(a){var c=b.tagData(a),d=b.getTagIdx(c);-1<d&&b.value.splice(d,1)})},removeAllTags:function b(a){a=a||{},this.value=[],"mix"==this.settings.mode?this.DOM.input.innerHTML="":this.removeTagsFromDOM(),this.dropdown.position(),"select"==this.settings.mode&&(this.input.set.call(this),this.setContentEditable(!0)),this.update(a)},postUpdate:function c(){var a=this.settings.classNames,b="mix"==this.settings.mode?this.settings.mixMode.integrated?this.DOM.input.textContent:this.DOM.originalInput.value.trim():this.value.length+this.input.raw.call(this).length;this.toggleClass(a.hasMaxTags,this.value.length>=this.settings.maxTags),this.toggleClass(a.hasNoTags,!this.value.length),this.toggleClass(a.empty,!b)},setOriginalInputValue:function c(a){var b=this.DOM.originalInput;this.settings.mixMode.integrated||(b.value=a,b.tagifyValue=b.value,this.setPersistedData(a,"value"))},update:function c(a){var b=this.getInputValue();this.setOriginalInputValue(b),this.postUpdate(),(a||{}).withoutChangeEvent||this.state.blockChangeEvent||this.triggerChangeEvent()},getInputValue:function b(){var a=this.getCleanValue();return"mix"==this.settings.mode?this.getMixedTagsAsString(a):a.length?this.settings.originalInputValueFormat?this.settings.originalInputValueFormat(a):JSON.stringify(a):""},getCleanValue:function d(a){return b=a||this.value,c=this.dataProps,b&&Array.isArray(b)&&b.map(function(a){return m(a,c)});var b,c},getMixedTagsAsString:function d(){var a="",b=this,c=this.settings.mixTagsInterpolator;return function d(e){e.childNodes.forEach(function(e){if(1==e.nodeType){var f=b.tagData(e);if("BR"==e.tagName&&(a+="\r\n"),"DIV"==e.tagName||"P"==e.tagName)a+="\r\n",d(e);else if(h.call(b,e)&&f){if(f.__removed)return;a+=c[0]+JSON.stringify(m(f,b.dataProps))+c[1]}}else a+=e.textContent})}(this.DOM.input),a}},c.prototype.removeTag=c.prototype.removeTags,c})})(jQuery);